function bhImg(t){egg.ajax({url:"/ajax/image.html",success:function(e){e+='<span id="quillIndex" data-index="'+t+'" style="display:none;"></span>',egg.lightbox(e)}})}function bhImgOnOk(){var t=parseInt(egg(":radio[name=bhImgMode]:checked").val(),10);switch(t){case 1:egg("#BH-popup :radio,#bhImgBtnOk").attr("disabled",!0),egg("#bhImgMsg").html("圖片上傳中, 請稍候...").show(),egg("#bhImgModeUpload").hide();break;case 2:return balaInsertSelectedImage(),!1;case 3:return balaInsertImage(),!1}return!0}function bhImgModeChange(t){switch(egg("#bhImgModeUpload,#bhImgModeInsertUrl,#bhImgModeTruth,#bhImgTruth").hide(),t){case 1:egg("#bhImgModeUpload").show(),egg("#BH-popup").css("width","350px");break;case 2:egg("#BH-popup :radio,#bhImgBtnOk").attr("disabled",!0),egg("#bhImgMsg").html("取得資料中, 請稍候...").show(),egg("#bhImgTruth").html(""),egg("#bhImgModeTruth").show(),balaListTruthImage(1);break;case 3:egg("#BH-popup").css("width","350px"),egg("#bhImgModeInsertUrl").show()}egg.lightbox.refresh()}function balaInsertSelectedImage(t){return t||(t="",jQuery(":checkbox[name=bhImgChkImage]:checked").each(function(){t+=this.value+" "}),""!==t)?void balaInsertUploadedImage(t):void Dialogify.alert("請勾選要引用的圖片")}function balaListTruthImage(t){jQuery.ajax({url:"/ajax/list_truth_image.php",data:{p:t},success:function(e){if("ERR_NOLOGIN"==e)return void Dialogify.alert("請先登入");if(1==t)jQuery("#bhImgTruth").html(e).show();else{var a=jQuery("#bhImgMoreImage"+t).get(0),i=a.parentNode;jQuery(document.createElement("div")).html(e).appendTo(i),i.removeChild(a)}jQuery("#BH-popup").css("width","610px"),jQuery("#bhImgMsg").hide(),jQuery("#BH-popup :radio,#bhImgBtnOk").attr("disabled",!1),egg.lightbox.refresh()},error:function(t){Dialogify.alert("發生錯誤, 請稍後再試一次")}})}function balaInsertImage(){var t=jQuery("#bhImgImageUrl").val();if(!t.match(/^https?:\/\/.*?\.(?:jpg|jpeg|gif|png)(?:\?.*)?$/i))return void Dialogify.alert("請輸入正確圖片網址");if(t=Util.HttpImgFilter.forceToHttps(t),!t)return void Dialogify.alert("這個圖床不支援 https 唷!");var e=Forum.C.quills[jQuery("#quillIndex").data("index")-1];e.focus();var a=e.getSelection();a&&(e.insertEmbed(a.index,"image",t),e.setSelection(a.index+1,0)),egg.lightbox.close(),e.focus()}function balaInsertUploadedImage(t){t=t.split(/[\s\n]+/);var e=Forum.C.quills[jQuery("#quillIndex").data("index")-1];e.focus();var a=e.getSelection();if(a)for(var i=t.length-1;i>=0;i--)t[i]&&(e.insertEmbed(a.index,"image",t[i]),e.setSelection(a.index+t.length-1,0));egg.lightbox.close(),e.focus()}function quickPost(t,e,a){var i=new Bahacode(Forum.C.quills[t-1].root).convert();jQuery("input[name=rtecontent]").val(i);var n=document.frm;chkdata(n,a)&&Dialogify.confirm("確定發表?",{ok:function(){ga("send","event",{eventCategory:"互動",eventAction:"哈啦區",eventLabel:"回覆",transport:"beacon"}),60076==parseInt(a,10)&&ga("send","event",{eventCategory:"互動",eventAction:"哈啦區",eventLabel:"回覆-場外",transport:"beacon"}),n.onpost.value=1,n.submit()}})}function chkdata(t,e){return!t.rtecontent.value||t.rtecontent.value.trim().match(/^\[div\]\s+\[\/div\]$/m)?(Dialogify.alert("請填寫內容"),!1):"60076"==e&&0==ruleflag?(Dialogify.alert("你沒有同意此板發文規則"),!1):1==t.onpost.value?(Dialogify.alert("處理中，請稍候"),!1):!0}function delPost(t,e,a){var i=jQuery("#cf"+t).html(),n=/<img .*?src="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpg|jpeg|gif|png)(?:\?[^\?"]*)?"[^>]*?>/i,o=/<a .*?id="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpg|jpeg|gif|png)(?:\?[^\?"]*)?"[^>]*?>/i,r="確定要刪除嗎？";(i.match(n)||i.match(o))&&(r+='<br /><label><input type="checkbox" id="chkDelTruthImage" value="yes" />若文中有我上傳至巴哈的圖片也一併刪除</label>'),Dialogify.confirm(r,{ok:function(){jQuery("#chkDelTruthImage:checked").length&&(e+="&dt=yes"),setCookie("ckFORUM_pdel",a),location.href="post2.php?"+e}})}!function(t,e){function a(){t("<div />").addClass("tour-overlay").attr("id","tourOverlay").appendTo("body")}function i(){t("#tourOverlay").remove()}function n(){return/bot|googlebot|crawler|spider|robot|crawling/i.test(e.navigator.userAgent)}function o(t){var e,a=/^https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})/,i=/^https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})/,n=/^https?:\/\/www\.twitch\.tv\/([a-zA-Z0-9_-]+)/,o=/^https?:\/\/www\.twitch\.tv\/videos\/([0-9]+)/,r=/^https?:\/\/vlog\.xuite\.net\/play\/([a-zA-Z0-9+\/=]+)/,s=/^https?:\/\/www\.nicovideo\.jp\/watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})/,c=/^https:\/\/livehouse\.in\/channel\/(\w+)/,l=/^https:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\//;return(e=t.match(a)||t.match(i))?"https://www.youtube.com/watch?v="+e[1]:(e=t.match(o))?null:(e=t.match(n)||t.match(r)||t.match(s)||t.match(c)||t.match(l))?e[0]:null}function r(a,i,n,o){t.ajax({type:"GET",url:"/ajax/GPBPlist.php",data:{t:n.type,bsn:n.bsn,snB:n.sn,p:o},dataType:"json",success:function(o){var s,c,l=t("#gpbpList > div");if("F"==o.status)l.text(o.msg);else{var d=JSON.parse(o.u),p="";for(var u in d)p+='<a target="_blank" href="https://home.gamer.com.tw/'+u+'">',p+='<img class="gamercard" data-gamercard-userid="'+u+'" src="'+d[u].avatar+'"></a>';o.page&&(p+='<div class="buttons">',o.page.p&&(s=function(){r(a,i,n,o.page.p)},p+='<button id="gpbpListPrev" type="button" class="btn--sm btn--normal">上一頁</button>'),o.page.n&&(c=function(){r(a,i,n,o.page.n)},p+='<button id="gpbpListNext" type="button" class="btn--sm btn--normal">下一頁</button>'),p+="</div>"),l.html(p)}a.update(i),t(i).find("#gpbpListPrev").off("click").on("click",s||function(){}),t(i).find("#gpbpListNext").off("click").on("click",c||function(){}),e.GamerCard&&e.GamerCard.bind('[data-template-id="#gpbpList"]')}})}function s(a,i,n,o,r){var c={bsn:o.bsn,snB:o.snB,snC:o.sn,t:n,p:r};t.get("/ajax/comment_gpbp_list.php",c,function(r){var c,l,d=t("#gpbpList > div");if(r.message)d.text(r.message);else{var p=r.list,u="";for(var h in p)u+='<a target="_blank" href="https://home.gamer.com.tw/'+p[h].userid+'">',u+='<img class="gamercard" data-gamercard-userid="'+p[h].userid+'" src="'+p[h].avatar+'"></a>';(r.next||r.prev)&&(u+='<div class="buttons">',r.prev&&(c=function(){s(a,i,n,o,r.prev)},u+='<button id="gpbpListPrev" type="button" class="btn--sm btn--normal">上一頁</button>'),r.next&&(l=function(){s(a,i,n,o,r.next)},u+='<button id="gpbpListNext" type="button" class="btn--sm btn--normal">下一頁</button>'),u+="</div>"),d.html(u)}a.update(i),t(i).find("#gpbpListPrev").off("click").on("click",c||function(){}),t(i).find("#gpbpListNext").off("click").on("click",l||function(){}),e.GamerCard&&e.GamerCard.bind('[data-template-id="#gpbpList"]')})}function c(e,a){var i=e.value.lastIndexOf("@",e.selectionStart);-1==i?i=e.selectionStart:i>0&&i--;var n=e.value.substring(i,e.selectionEnd);if(n.match(/^ ?@$/)&&!B){var o=getCaretCoordinates(e,e.selectionEnd),r=o.left-t(e).width()/2;H.offset=r,q=tippy(e,H);var s=q.getPopperElement(e);q.show(s)}else if(B)if(27==a||-1!=[8,33,34,35,36,37,39].indexOf(a)&&!n.match(/^ ?@.*$/)){var s=q.getPopperElement(e);q.hide(s)}else-1==[16,17,18].indexOf(a)&&d(e)}function l(t,e,a){return'          <li>            <a class="tag-user" href="javascript:;" onclick="Forum.C.tagUser('+t+",'"+e.userid+"', '"+e.nickname+"', "+a+');">              <div class="userpic">                <img class="lazyload" data-src="'+e.avatar+'">              </div>              <span class="username">'+e.nickname+"</span>            </a>          </li>"}function d(e){if(B){var a=e.value.lastIndexOf("@",e.selectionStart);if(-1!=a){var i=e.value.substring(a+1,e.selectionEnd).toLowerCase(),n=t(e).data("snb"),o=t(e).data("snc")||0,r="post_"+n,s="",c="";for(var d in S[r]){var u=S[r][d];-1!=u.nickname.toLowerCase().indexOf(i)&&u.userid.toLowerCase()!=Cookies.get("BAHAID").toLowerCase()&&(c+=l(n,u,o))}c&&(c="<h3>留言名單</h3><ul>"+c+"</ul>");for(var h in S.friend)-1!=S.friend[h].nickname.toLowerCase().indexOf(i)&&(s+=l(n,S.friend[h],o));s&&(s="<h3>好友名單</h3><ul>"+s+"</ul>"),c||s?t(".tag-list").html(c+s):t(".tag-list").html("<h3>沒有相符的名單</h3>");var f=q.getPopperElement(e);q.update(f);var m=t(f).find(".tag-user");m.mouseenter(function(e){m.removeClass("active"),t(this).addClass("active")}),setTimeout(function(){p(f,0)},1)}}}function p(e,a){var i,n,o=t(e).find(".tag-user"),r=o.filter(".active");if(0!=o.length){if("string"==typeof a){var s=parseInt(a,10);n=o.index(r)+s,n>=o.length?n=0:0>n&&(n=o.length-1)}else n=a;i=o.filter(":eq("+n+")"),r.removeClass("active"),i.addClass("active");var c=t(e).find(".tag-list"),l=i.position().top+c.scrollTop()-150+16;c.stop().animate({scrollTop:l},200)}}function u(e,a){var i=t(e).data("snb");t(e).data("snc")||0;if(S.friend)h(i),d(e);else{var n={u:Cookies.get("BAHAID")};t.get("/ajax/tag_list_friend.php",n,function(t){t.error?toastr.error(t.error):(S.friend=t,h(i),d(e))})}}function h(e){var a="post_"+e,i={},n=t("#"+a),o=n.find(".c-post__header__author"),r=o.find(".userid").text();i[r.toLowerCase()]={userid:r,nickname:o.find(".username").text(),avatar:v(r)};var s=n.find("#Commendlist_"+e+" div.c-reply__item");s.each(function(){var e=t(this).find(".gamercard"),a=e.data("gamercard-userid");i[a.toLowerCase()]={userid:a,nickname:t(this).find(".reply-content__user").text(),avatar:e.data("src")}}),S[a]=i}function f(t){if(!Cookies.get("BAHAID")){var a=e.location,i="https://"+a.host+a.pathname+a.search+"#reply"+t;Cookies.set("ckFrom",i,{path:"/",domain:".gamer.com.tw"}),a.href="https://user.gamer.com.tw/login.php"}}function m(e){t(e).height(20),t(e).height(e.scrollHeight)}function g(e,a,i){i*=3;var n=t(e).val(),o=n.match(/[^\x00-\xff]/gi),r=null===o?n.length:n.length+2*o.length,s=t(e).parents(".reply-input"),c=a.getPopperElement(s.get(0));r>i?(s.addClass("warning"),a.show(c)):(s.removeClass("warning"),a.hide(c))}function v(t){t=t.toLowerCase();var e="https://avatar2.bahamut.com.tw/avataruserpic/";return e+=t.charAt(0)+"/"+t.charAt(1)+"/",e+=t+"/"+t+"_s.png"}function b(e,a,i,n){var o=e.value,r=o.match(/[^\x00-\xff]/gi),s=null===r?o.length:o.length+2*r.length;if(s>240)return toastr.warning("留言字數過多！"),void e.focus();if(""==o.replace(/(^\s*)|(\s*$)/g,"")||""==o.replace(/ |　/g,""))return toastr.warning("請輸入留言"),void e.focus();var c=n?"/ajax/edit_comment.php":"/ajax/newCommend.php";e.disabled=!0,getCSRFToken().done(function(r){t.post(c,{bsn:a,snB:i,snC:n||0,c:o,token:r,returnHtml:1}).done(function(o){if(o.errMsg)return void toastr.error(o.errMsg);var r="#Commendcontent_"+o.snC;n?t(r).replaceWith(o.html):t("#Commendlist_"+i).append(o.html),C.bindReplyMenuTippy(r),C.bindCommentGpBpListTippy(r),C.bindCommentDateTippy(r),C.commentFormatter(r+" .reply-content__article > span"),GamerCard.bind(r),e.value="";var s=n?"編輯留言":"留言";ga("send","event","互動","哈啦區",s),60076==parseInt(a,10)&&ga("send","event","互動","哈啦區",s+"-場外")}).always(function(){e.disabled=!1,e.focus()})})}function w(t){var n="FOURM_TOUR_comment";if(Cookies.get("BAHAID")&&"shown"!=e.localStorage.getItem(n)){var o=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0}});o.on("start",function(){a()}),o.on("complete",function(){i(),t.focus(),e.localStorage.setItem(n,"shown")}),o.on("cancel",function(){i(),t.focus(),e.localStorage.setItem(n,"shown")}),o.addStep("step1",{text:"1. 點擊「回覆」留言者，讓通知不漏接。<br>2. 輸入「@好友暱稱」，分享好文給巴哈好友！",attachTo:{element:t,on:"top"},title:"留言標記功能",buttons:{text:"我知道了",action:o.next}}),o.start()}}function y(a,i,n){return Cookies.get("BAHAID")?(t(a).prop("disabled",!0),void getCSRFToken().done(function(e){var o={token:e,bsn:n.bsn,snB:n.snB,snC:n.sn,t:i};t.post("/ajax/comment_gpbp.php",o,function(e){if(t(a).prop("disabled",!1),e.message)return void(1==e.code?C.commentRestoreGpBp(n.bsn,n.snB,n.sn):toastr.warning(e.message,"",{tapToDismiss:!0}));var i=e.bsn,o=e.snB,r=e.snC,s=e.type,c="Forum.C.commentRestoreGpBp("+i+", "+o+", "+r+");",l='<a href="javascript:'+c+'" style="float:right;color:yellow;">復原</a>';s==_?(l="勇者獲得了 1 點能量"+l,ga("send","event","互動","哈啦區","留言推")):(l="勇者削弱了 1 點精神"+l,ga("send","event","互動","哈啦區","留言噓")),k(s,r,1),L[i+"_"+o+"_"+r]=toastr.success(l,"",{timeOut:1e4})})})):void(e.location.href="https://user.gamer.com.tw/login.php")}function k(e,a,i){var n=e==_?"gp":"bp",o=t("#Commendcontent_"+a),r=o.find("."+n+"-count"),s=parseInt(r.data(n),10)||0;s+=i,r.data(n,s),e==_?s>0?(r.text(s),r.hasClass("is-highlight")||r.addClass("is-highlight").prev("button").addClass("is-highlight")):(r.text(""),r.hasClass("is-highlight")&&r.removeClass("is-highlight").prev("button").removeClass("is-highlight")):5>s&&r.text("")||r.text(s),C.bindCommentGpBpListTippy(o)}function x(e){var a=t(e).parents(".c-reply__item");T=a.find(".reply-content").html().replace(/ data-tooltipped=""/g,"").replace(/data-original-title=/g,"title=");var i=a.data("comment");a.addClass("c-reply__editor").find(".reply-content").empty().html('<div class="reply-input" title="超過80個字了喔～">  <textarea data-bsn="'+i.bsn+'" data-snb="'+i.snB+'" data-snc="'+i.sn+'" placeholder="留言⋯" class="content-edit"></textarea>  <div class="comment_icon">    <a title="插入圖片" href="javascript:;" onclick="Forum.C.insertImage(this);"><img src="https://i2.bahamut.com.tw/forum/icons/comment_image.svg"></a>  </div></div><div class="reply-content__send">  <p>按 enter 送出 或按 esc <a href="javascript:;" onclick="Forum.C.editCommentCancel(this);">取消</a></p></div>        ');var n=i.content.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#0?39;/g,"'").replace(/&quot;/g,'"');a.find(".content-edit").text(n),j=tippy(a.find(".reply-input").get(0),{trigger:"manual",arrow:!0,arrowSize:"small",hideOnClick:"persistent"});var o=a.find(".content-edit");C.initCommentInput(o),o.focus()}var C={quills:[],initializeQuill:function(a){a=a||".c-editor__input .content-edit";const i=[["bold","italic"],[{color:["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#790000","#ff6600","#7f7f00","#808080","#008080","#0000ff","#666699","#808080","#ff0000","#ff9900","#99cc00","#339966","#33cccc","#3366ff","#800080","#999999","#ff00ff","#ffcc00","#ffff00","#00ff00","#00ffff","#00ccff","#993366","#c0c0c0","#ff99cc","#ffcc99","#ffff99","#ccffcc","#ccffff","#99ccff","#cc99ff","#ffffff"]}],[{size:["13px",!1,"18px","24px","32px"]}],["link"],["clean"]];t(a).each(function(a,n){var r=new Quill(n,{placeholder:t(n).data("placeholder"),theme:"bubble",modules:{toolbar:i}});r.clipboard.addMatcher(Node.TEXT_NODE,function(t,e){if("string"==typeof t.data){var a=/https?:\/\/[^\s]+/g,i=t.data.match(a);if(i&&i.length>0){var n=[],r=t.data;i.forEach(function(t){var e=r.split(t),a=e.shift();n.push({insert:a});var i=t.match(/\.(?:png|jpg|jpeg|gif)$/i),s=o(t);if(i||s)if(s)n.push({insert:{image:"https://i2.bahamut.com.tw/editor/movie_pre.gif"},attributes:{alt:s,width:640,height:360}});else{var c=t;c.match(/^https:\/\//)||(c=Util.HttpImgFilter.forceToHttps(c)),c?n.push({insert:{image:c}}):n.push({insert:t,attributes:{link:t}})}else n.push({insert:t,attributes:{link:t}});r=e.join(t)}),n.push({insert:r}),e.ops=n}return e}}),r.once("editor-change",function(a){if(!Cookies.get("BAHAID")){var i=e.location,o="https://"+i.host+i.pathname+i.search+"#quickPostAnchor";Cookies.set("ckFrom",o,{path:"/",domain:".gamer.com.tw"}),i.href="https://user.gamer.com.tw/login.php"}"60076"==t(n).data("bsn")&&rulechk("")});var s=r.theme.tooltip,c=s.root.querySelector("input[data-link]");c.dataset.link="輸入連結";var l=tippy(".c-editor .toolbar > button:nth-child(2):not([data-tooltipped])",{html:"#emotionList",position:"bottom",arrow:!0,interactive:!0,trigger:"click",theme:"light",duration:240,onShow:function(){var e=this,a=l.getReferenceElement(e);t(e).css({minWidth:"370px",minHeight:"123px"}).find("img").off("click").on("click",function(i){var n=C.quills[t(a).data("index")-1];n.focus();var o=n.getSelection();o&&(n.insertEmbed(o.index,"image",i.target.src),n.setSelection(o.index+1,0)),l.hide(e),n.focus()})}});C.quills.push(r)})},bindOptionMenuTippy:function(){var e=tippy(".tippy-option-menu:not([data-tooltipped])",{html:"#optionMenu",position:"top",arrow:!0,interactive:!0,hideOnClick:!1,theme:"light",distance:5,duration:240,onShow:function(){var a=this,i=e.getReferenceElement(a),n=t(i).data("tippy");t(a).find("a:eq(0)").attr("href",function(){var t="C.php?bsn="+n.bsn+"&snA="+n.snA;return n.readingAuthor?t:t+"&s_author="+n.author}).html(function(){return n.readingAuthor?"顯示全部文章":"看他的文"}),t(a).find("a:eq(1)").off("click").on("click",function(t){e.hide(a),FORUM_homeBookmark(n.area,n.bsn,n.sn,n.title,n.dc_c1,n.dc_c2,n.dc_type,n.dc_machine,n.dc_name)}),t(a).find("a:eq(2)").off("click").on("click",function(t){e.hide(a),accuse_step1(n.bsn,n.sn,"1")}),t(a).find("a:eq(3)").off("click").on("click",function(t){e.hide(a),pdel(n.sn)}),t(a).find("a:eq(4)").off("click").on("click",function(t){e.hide(a),pmodify(n.snA,n.sn,1)}),t(a).find("a:eq(5)").off("click").on("click",function(t){e.hide(a),FORUM_homeBookmark(n.area,n.bsn,n.sn,n.title,n.dc_c1,n.dc_c2,n.dc_type,n.dc_machine,n.dc_name)}),"G2"==n.area?(t(a).find("ul:eq(0)").hide(),t(a).find("ul:eq(1)").hide()):(t(a).find("ul:eq(2)").hide(),n.owner&&t(a).find("ul:eq(1)").show()||t(a).find("ul:eq(1)").hide())}})},bindManageMenuTippy:function(){var e=tippy(".tippy-manage-menu:not([data-tooltipped])",{html:"#manageMenu",position:"top",arrow:!0,interactive:!0,hideOnClick:!1,theme:"light",duration:240,onShow:function(){var a=this,i=e.getReferenceElement(a),n=t(i).data("tippy");t(a).find("a:eq(0)").off("click").on("click",function(t){e.hide(a),del(n.sn)}),t(a).find("a:eq(1)").off("click").on("click",function(t){e.hide(a),Dialogify.confirm("水桶同時請注意文章是否需要刪除，確定要水桶了嗎？",{ok:function(){FORUM_water(n.bsn,n.author,"1","https://forum.gamer.com.tw/Co.php?bsn="+n.bsn+"&sn="+n.sn)}})}),t(a).find("a:eq(2)").off("click").on("click",function(t){e.hide(a),M(n.sn)}),t(a).find("a:eq(3)").off("click").on("click",function(t){e.hide(a),gather(n.sn)}),t(a).find("a:eq(4)").off("click").on("click",function(t){e.hide(a),location.href="BMADMIN/index.php?bsn="+n.bsn+"&p="+n.parent}),"G2"==n.area?t(a).find("ul:eq(0)").hide():(t(a).find("ul:eq(1)").hide(),n.isBM&&t(a).find("li:eq(0), li:eq(1)").show()||t(a).find("li:eq(0), li:eq(1)").hide())}})},bindPostInfoTippy:function(){var e=tippy(".tippy-post-info:not([data-tooltipped])",{html:"#postInfo",position:"bottom",arrow:!0,interactive:!0,delay:600,hideDelay:300,theme:"light",hideOnClick:!1,distance:5,duration:240,onShow:function(){var a=e.getReferenceElement(this),i=t(a).data("hideip"),n=t(a).data("mtime");t("#postInfo").find("p:eq(0)").text(i).end().find("p:eq(1)").text(n);var o=t("#postInfo").find("li:eq(0)");"G2"==t(a).data("area")&&o.hide()||o.show(),e.update(this)}})},bindReplyMenuTippy:function(e){var a=t(e||"body").find(".tippy-reply-menu:not([data-tooltipped])").get(),i=tippy(a,{html:"#replyMenu",position:"bottom-end",arrow:!0,interactive:!0,trigger:"click",theme:"light",animateFill:!1,distance:5,duration:240,onShow:function(){var e=this,a=i.getReferenceElement(e),n=t(a).parents(".c-reply__item").data("comment"),o=t(e).find("a");if(o.removeAttr("style"),t(a).parents(".c-reply__item").find(".content-edit").length)return void o.off("click").css("color","#999");t(e).find("a:eq(2)").off("click").on("click",function(t){return i.hide(e),n.isLogin?showaccuseCommend(n.bsn,n.snB,n.sn):void(location.href="https://user.gamer.com.tw/login.php")});var r=t(e).find("a:eq(1)");n.deletable?(r.parent("li").show(),r.off("click").on("click",function(t){return i.hide(e),delCommend(n.bsn,n.snB,n.sn)})):r.off("click").parent("li").hide();var s=t(e).find("a:eq(0)");n.editable?(s.parent("li").show(),s.off("click").on("click",function(t){i.hide(e),x(a)})):s.off("click").parent("li").hide()}})},bindSimpleTippy:function(){tippy(".tippy-gpbp, .tippy-guild-flag, .usercareer, .userrace, .usergp",{delay:600,duration:240,touchHold:!0,theme:"gpbp"})},bindGpBpListTippy:function(){var e=tippy(".tippy-gpbp-list",{html:"#gpbpList",position:"bottom-start",arrowSize:"big",arrow:!0,trigger:"click",theme:"light",interactive:!0,duration:240,onShow:function(){t("#gpbpList > div").html('<img src="https://i2.bahamut.com.tw/mobile/loading.svg">'),e.update(this);var a=t(e.getReferenceElement(this)).data("tippy");r(e,this,a,1)}})},bindCommentGpBpListTippy:function(e){e=e||"body";var a=[];if(t(e).find(".gp-count:not([data-tooltipped]), .bp-count:not([data-tooltipped])").each(function(){isNaN(parseInt(t(this).text(),10))||a.push(this)}),0!=a.length)var i=tippy(a,{html:"#gpbpList",position:"bottom-start",arrowSize:"big",arrow:!0,trigger:"click",theme:"light",interactive:!0,duration:240,onShow:function(){t("#gpbpList > div").html('<img src="https://i2.bahamut.com.tw/mobile/loading.svg">'),i.update(this);var e=t(i.getReferenceElement(this)),a=e.hasClass("gp-count")?_:I,n=e.parents(".c-reply__item").data("comment");s(i,this,a,n,1)}})},bindCommentWarningTippy:function(){A=tippy(".reply-input:not([data-tooltipped])",{trigger:"manual",arrow:!0,arrowSize:"small",hideOnClick:"persistent"})},bindCommentDateTippy:function(e){var a=t(e||"body").find(".reply-content__footer .edittime").get();tippy(a,{trigger:"click",duration:240,theme:"gpbp"})},initCommentInput:function(e){var a=t(e).parents(".c-reply__item").length;t(e||".reply-input > .content-edit").click(function(e){var a=t(this).data("snb");f(a),w(this)}).keypress(function(e){if(Cookies.get("BAHAID")){var a=t(this).data("bsn"),i=t(this).data("snb"),n=t(this).data("snc")||0;switch(e.which||e.keyCode){case 13:if(e.preventDefault(),B){var o=q.getPopperElement(this);t(o).find(".tag-user.active").click()}else b(this,a,i,n)}}}).keydown(function(t){if(Cookies.get("BAHAID"))switch(t.which||t.keyCode){case 38:case 40:if(B){t.preventDefault();var e=q.getPopperElement(this);p(e,38==(t.which||t.keyCode)?"-1":"+1")}break;case 27:a&&!B&&C.editCommentCancel(this)}}).keyup(function(t){if(Cookies.get("BAHAID")){var e=t.which||t.keyCode;38!=e&&40!=e&&c(this,e)}}).on("input focus",function(t){g(this,a?j:A,80),m(this)})},showHonor:function(){var a=e.honorData();t(".c-user__honor").each(function(e,i){if(t(i).data("honors"))for(var n=t(i).data("honors").toString().split(","),e=0;e<n.length;e++){var o=n[e];if(""!=o&&0!=o){var r=1==a[o][1]?'href="http://avatar1.gamer.com.tw/switchhonor.php?uid='+t(i).data("userid")+"&htype="+o+'" target="_blank"':'href="javascript:;"',s="<a "+r+'><img src="https://p2.bahamut.com.tw/HOME/honor/'+o+".gif"+a[o][2]+'" title="'+a[o][0]+'" /></a>';t(i).append(s)}}})},commentFormatter:function(a){a=t(a),a.each(function(a){var i=t(this);if("yes"!=i.data("formatted")){var n=i.parents("[data-comment]").data("comment").content;n=n.replace(/https?:\/\/[!#-&(-;=?-Z\^-~]+/gi,function(t){var e,a,i=/^https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})(?:&(t=[hms0-9]+))?/,n=/^https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:\?(t=[hms0-9]+))?/,o=/^https?:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\//;return/^https:\/\/.+?\.(?:jpe?g|gif|png)$/i.test(t)?(a='<a class="photoswipe-image" target="_blank" href="'+t+'">',a+='<img class="lazyload" data-src="'+t+'"></a>'):(e=t.match(i)||t.match(n))?(a='<a target="_blank" href="https://www.youtube.com/watch?v='+e[1]+(e[2]?"&"+e[2]:"")+'">',a+='<img src="https://i2.bahamut.com.tw/youtube_play.png" style="width:120px;height:90px;background-image:url(https://img.youtube.com/vi/'+e[1]+'/default.jpg);"></a>'):(e=t.match(o))?(a='<a target="_blank" href="https://www.facebook.com/'+e[1]+"/videos/"+e[2]+'/">',a+='<img src="https://i2.bahamut.com.tw/youtube_play.png" style="width:120px;height:90px;background-image:url(https://graph.facebook.com/'+e[2]+'/picture);background-position: center;"></a>'):a='<a target="_blank" onclick="Forum.C.refurl(this);" href="'+t+'">'+t+"</a>",a}),n=n.replace(/(^|\s+)#([0-9]+)/g,function(t,a,i){var n=e.location.search.match(/bsn=([0-9]+)/),o=e.location.search.match(/snA=([0-9]+)/);if(n&&o){var r=a+'<a href="https://forum.gamer.com.tw';return r+=e.location.pathname,r+="?bsn="+n[1]+"&snA="+o[1]+"&to="+i+'">#'+i+"</a>"}return t}),n=n.replace(/\[([a-zA-Z][a-zA-Z0-9]{1,11}):([^\]]*)\]/g,function(t,e,a){return'<a target="_blank" href="https://home.gamer.com.tw/'+e+'">'+a+"</a>"}),i.attr("data-formatted","yes").html(n)}})},refurl:function(t){t.href.match(/^https?:\/\/ref\.gamer\.com\.tw/)||(t.href="https://ref.gamer.com.tw/redir.php?url="+encodeURIComponent(t.href))},dockedTitle:function(){var a=t(".BH-menu"),i=t("#BH-wrapper"),n=t(".c-fixed--header"),o=t(".c-fixed--header .c-menu"),r=t(".TOP-data").height(),s=a.outerHeight(),c=Math.max(a.offset().top-r,0),l=a.outerHeight(!0);0==t(".bh-banner").height()&&(l+=r);var d=0;a.hasClass("fixed")&&(a.removeClass("fixed").removeAttr("style"),i.css("marginTop",0),c=Math.max(a.offset().top-r,0),a.addClass("fixed"),a.css("top",r-s),i.css("marginTop",l),n.show(),o.addClass("is-scroll is-switch"));var p=function(){var i=t(e).scrollTop();i>c&&!a.hasClass("fixed")?(a.addClass("fixed"),n.show(),o.addClass("is-scroll is-switch")):c>=i&&a.hasClass("fixed")&&(a.removeClass("fixed").removeAttr("style"),n.hide(),o.removeClass("is-scroll is-switch")),a.hasClass("fixed")&&(d>i&&!o.hasClass("is-switch")?(a.css("top",r),o.addClass("is-switch")):i>d&&o.hasClass("is-switch")&&(a.css("top",r-s),o.removeClass("is-switch"))),d=i};t(function(){s=a.outerHeight(),t(e).off("scroll",BahamutMenu.onScroll).on("scroll",p),p()})},elevator:function(a,i,n){if(a=a||e.event,13==a.keyCode){var o=parseInt((a.target||a.srcElement).value,10);if(!isNaN(o))if(e.dataLayer&&e.dataLayer.push({event:"bh.elevator"}),t("[data-floor="+o+"]").length){var r=t("[data-floor="+o+"]:visible").parents(".c-post, .c-disable"),s=r.offset().top-130;jQuery("html, body").scrollTop(s),r.css("animation","2s highlight")}else{var c=e.location;c.href="https://"+c.host+c.pathname+"?bsn="+i+"&snA="+n+"&to="+o}}},toggleDisplayImage:function(){"yes"==Cookies.get("ckForumShrinkMedia")?(Cookies.remove("ckForumShrinkMedia",{domain:"gamer.com.tw"}),Forum.Common.expandAll(),t(".c-menu__scrolldown > .toolbar > :last").text("關圖"),t(".btn-loadpic").addClass("is-cancel").attr("title","關閉圖片影片"),tippy(".btn-loadpic",{delay:600,duration:240,theme:"gpbp"})):(Cookies.set("ckForumShrinkMedia","yes",{expires:365,domain:"gamer.com.tw"}),e.location.reload())},tourC:function(){if(!n()){var o=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0}});o.on("start",function(){a()}),o.on("complete",function(){i(),e.scroll({top:0,left:0,behavior:"smooth"})}),o.on("cancel",function(){i()});var r=[{text:"文中的”圖片／影片”想預設 開 或 關？<br>圖片開關，方便你隨心所欲自由切換。",attachTo:{element:".btn-loadpic",on:"bottom"},title:"圖片開關",buttons:{text:"我知道了",action:o.next},scrollTo:!0,scrollToHandler:function(){e.scroll({top:0,left:0,behavior:"smooth"})}},{text:"不管是”看他的文、收藏文章、檢舉違規”<br>還是”編輯、刪除”自己的文章，全收納在”點點點”。",attachTo:{element:".tippy-option-menu",on:"right"},title:"單篇更多功能“點點點",buttons:{text:"我知道了",action:o.next},scrollTo:!0,scrollToHandler:function(){e.scroll({top:t(".tippy-option-menu:first").offset().top-240,left:0,behavior:"smooth"})}},{text:"1. 輸入指定樓數，「電梯」就能帶你快速前往！<br>2. 返回文章列表<br>3. 回頁面上方",attachTo:{element:".jumpfloor",on:"left"},title:"常駐動線",buttons:{text:"我知道了",action:o.next},when:{show:function(){t(".c-fixed--header:visible").length>0&&o.addStep("stepFixedHeader",{text:"討論串功能置頂顯示，讓你不管看到哪，都能隨時使用。<br>這裡也有圖片開關唷！",attachTo:".c-fixed--header bottom",title:"置頂標題工具列",buttons:{text:"我知道了",action:o.next}})}}},{text:"1. 免換頁，快速回文最方便。<br>2. 連結／圖片連結／影片連結皆可無腦貼上，不需要另外插入。<br>3. 寫到哪編到哪，將文字反白即可直接顯示功能選項。",attachTo:{element:".c-editor",on:"top"},title:"快速回覆區直覺式編輯",buttons:{text:"我知道了",action:o.next},scrollTo:!0,scrollToHandler:function(){e.scroll({top:t(".c-editor__input:first").offset().top-240,left:0,behavior:"smooth"})}}];if(r.length>0){for(var s in r)t(r[s].attachTo.element).length&&o.addStep("step"+(s+1),r[s]);o.start()}}},tagUser:function(e,a,i,n){var o="textarea[data-snb="+e+"]";o+=n?"[data-snc="+n+"]":":not([data-snc])";var r=t(o).get(0);r.focus();var s=r.value.lastIndexOf("@",r.selectionStart);-1==s&&(s=r.selectionStart);var c=r.selectionEnd,l=r.value.substring(0,s),d=r.value.substring(c,r.value.length);if(i=i.replace("[","&#91;").replace("]","&#93;"),r.value=l+"["+a+":"+i+"]"+d,s=r.value.length-d.length,r.setSelectionRange(s,s),m(r),B){var p=q.getPopperElement(r);q.hide(p)}ga("send","event","互動","哈啦區","標記")},commentGp:function(e){var a=t(e).parents(".c-reply__item").data("comment");y(e,_,a)},commentBp:function(e){var a=t(e).parents(".c-reply__item").data("comment");y(e,I,a)},commentRestoreGpBp:function(e,a,i){var n=e+"_"+a+"_"+i;toastr.clear(L[n],{force:!0}),delete L[n],getCSRFToken().done(function(n){var o={token:n,bsn:e,snB:a,snC:i};t.post("/ajax/comment_restore_gpbp.php",o,function(t){return t.message?void toastr.warning(t.message,"",{tapToDismiss:!0}):(k(t.type,t.snC,-1),void toastr.info("您的動作已復原","",{tapToDismiss:!0}))})})},unfoldComment:function(e){t(e).parent().next().show(400).end().remove()},editCommentCancel:function(e){var a=t(e).parents(".c-reply__item"),i=j.getPopperElement(a.find(".reply-input").get(0));j.hide(i),a.find(".reply-content").html(T),C.bindCommentGpBpListTippy(a),C.bindCommentDateTippy(a)},insertImage:function(e){e=e instanceof HTMLElement?t(e).parents(".reply-input").find("textarea"):"#post_textarea_"+e+" [contenteditable]",new Bahamut.InsertImage(e).showDialog()},showAd:function(a,i){var n,o,r="",s="ad-native-c";a?(r+='<section class="c-section" style="display:none;">',r+='  <div class="c-section__main">',r+='    <div class="c-post__header" id="'+s+'" style="padding-left:18px; padding-top:2px; margin-bottom:0px;">',r+="    </div>",r+="  </div>",r+="</section>",n="/1017768/AD_desktopweb_forum_c_article_banner",o=[[728,90]]):(r+='<section class="c-section" style="display:none;">',r+='  <div class="c-section__side">',r+='    <div class="c-user">',r+='      <div class="c-user__side">',r+='        <div class="usericon userlevel junior" style="background: #e55039;">',r+="          <span>LV.</span>88",r+="        </div>",r+='        <div class="usericon usergp junior" style="background: #f6b93b;">',r+="          <span>GP</span>88K",r+="        </div>",r+='        <div class="usericon usercareer" style="background: #3c6382;">',r+='          <img src="https://i2.bahamut.com.tw/forum/icons/business.png">',r+="        </div>",r+='        <div class="usericon userrace" style="background: #3c6382;">',r+='          <img src="https://i2.bahamut.com.tw/forum/icons/human.png">',r+="        </div>",r+="      </div>",r+='      <a href="javascript:;" class="c-user__avatar">',r+='        <img src="https://i2.bahamut.com.tw/forum/ad-character.png?_=1" width="100%">',r+="      </a>",r+="    </div>",r+="  </div>",r+='  <div class="c-section__main c-post" style="border: 5px solid rgba(175, 175, 175, 0.2);min-height: 185px;">',r+='    <div class="c-post__header" id="'+s+'">',r+="    </div>",r+="  </div>",r+="</section>",n="/1017768/AD_desktopweb_forum_c_article_native",o=["fluid"]),googletag.cmd.push(function(){t(".c-section[id^=post_]:first").after(r);var a=googletag.defineSlot(n,o,s).addService(googletag.pubads()).setTargeting("bsn",i).setTargeting("service","forum"),c=Cookies.get("BAHALV")||"";c&&a.setTargeting("LV",c),e.DFP.setTargeting(),googletag.pubads().addEventListener("slotRenderEnded",function(e){if(e.slot.getSlotElementId()==s){var a=t("#"+s).parents("section.c-section");e.isEmpty?a.remove():a.fadeIn(200)}}),googletag.enableServices(),googletag.display(a)})}};const _=1,I=2;var T,S={},L={},A=null,j=null,q=null,B=!1,H={html:"#tagList",position:"bottom",trigger:"manual",interactive:!0,theme:"light",zIndex:2,sticky:!0,onShow:function(){B=!0;var t=q.getReferenceElement(this);u(t,this)},onShown:function(){var t=q.getReferenceElement(this);t.focus()},onHidden:function(){B=!1}};if(e.Quill){var z=Quill["import"]("attributors/style/size");z.whitelist=["13px","18px","24px","32px"],Quill.register(z,!0)}e.Forum=e.Forum||{},e.Forum.C=C}(jQuery,window),function(){function t(t,n,o){if(!a)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=o&&o.debug||!1;if(r){var s=document.querySelector("#input-textarea-caret-position-mirror-div");
s&&s.parentNode.removeChild(s)}var c=document.createElement("div");c.id="input-textarea-caret-position-mirror-div",document.body.appendChild(c);var l=c.style,d=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,p="INPUT"===t.nodeName;l.whiteSpace="pre-wrap",p||(l.wordWrap="break-word"),l.position="absolute",r||(l.visibility="hidden"),e.forEach(function(t){p&&"lineHeight"===t?l.lineHeight=d.height:l[t]=d[t]}),i?t.scrollHeight>parseInt(d.height)&&(l.overflowY="scroll"):l.overflow="hidden",c.textContent=t.value.substring(0,n),p&&(c.textContent=c.textContent.replace(/\s/g," "));var u=document.createElement("span");u.textContent=t.value.substring(n)||".",c.appendChild(u);var h={top:u.offsetTop+parseInt(d.borderTopWidth),left:u.offsetLeft+parseInt(d.borderLeftWidth),height:parseInt(d.lineHeight)};return r?u.style.backgroundColor="#aaa":document.body.removeChild(c),h}var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],a="undefined"!=typeof window,i=a&&null!=window.mozInnerScreenX;"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t:a&&(window.getCaretCoordinates=t)}(),function(){function t(t){for(var e={},a=t.split(","),i=0;i<a.length;i++)e[a[i]]=!0;return e}var e=/^<(\w+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,a=/^<\/(\w+)[^>]*>/,i=/([\w-]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,n=t("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),o=t("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul"),r=t("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),s=t("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),c=t("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),l=t("");this.HTMLParser=function(t,d){function p(t,e,a,l){if(o[e])for(;g.last()&&r[g.last()];)u("",g.last());if(s[e]&&g.last()==e&&u("",e),l=n[e]||!!l,l||g.push(e),d.start){var p=[];a.replace(i,function(t,e){var a=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:c[e]?e:"";p.push({name:e,value:a,escaped:a.replace(/(^|[^\\])"/g,'$1\\"')})}),d.start&&d.start(e,p,l)}}function u(t,e){if(e)for(var a=g.length-1;a>=0&&g[a]!=e;a--);else var a=0;if(a>=0){for(var i=g.length-1;i>=a;i--)d.end&&d.end(g[i]);g.length=a}}var h,f,m,g=[],v=t;for(g.last=function(){return this[this.length-1]},t=t.replace(/(<script[^>]*>).*?(<\/script\s*>)/gi,"$1$2"),t=t.replace(/(<style[^>]*>).*?(<\/style\s*>)/gi,"$1$2"),t=t.replace(/<meta[^>]*>/gi,""),t=t.replace(/<\?xml[^>]*>/gi,""),t=t.replace(/<xml[^>]*>[^<]*?<\/xml>/gi,""),t=t.replace(/<\/?\w+:\w+[^>]*>/gi,"");t;){if(f=!0,g.last()&&l[g.last()])t=t.replace(new RegExp("(.*?)</"+g.last()+"[^>]*>"),function(t,e){return e=e.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),""}),u("",g.last());else if(0==t.indexOf("<!--")?(h=t.indexOf("-->"),h>=0&&(d.comment&&d.comment(t.substring(4,h)),t=t.substring(h+3),f=!1)):0==t.indexOf("</")?(m=t.match(a),m&&(t=t.substring(m[0].length),m[0].replace(a,u),f=!1)):0==t.indexOf("<")&&(m=t.match(e),m&&(t=t.substring(m[0].length),m[0].replace(e,p),f=!1)),f){h=t.indexOf("<");var b=0>h?t:t.substring(0,h);t=0>h?"":t.substring(h),d.chars&&d.chars(b)}if(t==v)return;v=t}u()}}(),function(t){function e(t){if(!t.innerHTML)return"";a(t);var e=t.innerHTML,r="",s=[],c=["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed"],l=i(c);return e=e.replace(/[\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,""),e=e.replace(/\r\n|\r|\n/g,""),e=e.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;"),HTMLParser(e,{start:function(t,e,a){t=t.toLowerCase();var i=l[t];if("br"==t)r+="\n";else{var c;c=t.inArray(["img","td","th","tr","table","p","div"],!0)?n(t,e,i):o(t,e,i),""!==c.startTags&&(r+=c.startTags),""!==c.endTags||i?""!==c.endTags&&s.push(c.endTags):s.push(!1)}t.inArray(["table","tr","ol","ul"],!0)&&(r+="\n")},end:function(t){if(t=t.toLowerCase(),!l[t]){var e=s.pop();e!==!1&&(r+=e),t.inArray(["th","td","tr","li"],!0)&&(r+="\n")}},chars:function(t){r+=t},commnet:function(t){}}),r=r.replace(/\&[^;]+;/g,function(t){var e=i(f.code,f.value);return e[t]||t})}function a(t){if(0===t.childNodes.length&&t.nodeType==m&&!t.nodeName.inArray(["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed"],!0)){var e=t.parentNode;return e.removeChild(t),a(e),!0}if(t.hasChildNodes())for(var i=0;i<t.childNodes.length;i++)a(t.childNodes[i])&&i--;return!1}function i(t,e){var a,i={},n=t.length;for(a=0;n>a;a++)e?i[isNaN(t[a])?t[a].toLowerCase():t[a]]=e[a]:i[t[a]]=!0;return i}function n(t,e,a){var i,n,o=!1,s="",c="",l="",d="";for("p"==t&&(t="div"),n=0;n<e.length;n++)switch(e[n].value=e[n].value.trim(),e[n].name=e[n].name.trim().toLowerCase(),e[n].name){case"src":0===e[n].value.trim().toLowerCase().indexOf("images/")&&(e[n].value=location.href.substring(0,location.href.lastIndexOf("/")+1)+e[n].value);var p;if((p=e[n].value.trim().match(/(^http[s]?:\/\/(?:.*?)\/(?:.*)\.(?:jpg|jpeg|gif|png))(?:\?[^\?]*)?$/i))||e[n].value.trim().match(/^http:\/\/link\.photo\.pchome\.com\.tw\/s[0-9]{1,3}\/[a-zA-Z0-9\_]{4,16}\/[0-9]{1,4}\/[0-9]{10,15}\/$/i)){var u=/https?:\/\/(?:pic|i1|i2)\.bahamut\.com\.tw\/editor\/emotion\/([1-9][0-9]?)\.gif/;if("img"==t)if(i=e[n].value.match(u))s="="+i[1]+s,t="em";else{var f;f=p?p[1]:e[n].value,s="="+f+s,o=!0}}break;case"data-movie":case"alt":"img"==t&&e[n].value.match(/^https?:\/\//)&&(d=e[n].value);break;case"width":case"height":e[n].value.match(/^[1-9][0-9]{0,2}[%]?$/)&&(s+=" "+e[n].name+"="+e[n].value);break;case"cellspacing":case"cellpadding":e[n].value.match(/^[0-9]$/)&&(s+=" "+e[n].name+"="+e[n].value);break;case"style":var m=r(e[n].value,t,!0);m.attribute.match(/bgcolor/i)&&(s=s.replace(/ bgcolor=[^ ]+/i,"")),s+=m.attribute,c+=m.startTags,l=m.endTags+l;break;case"bgcolor":"td"!=t&&"th"!=t&&"tr"!=t||!e[n].value.match(/^(?:[a-zA-Z]{3,20}|#[0-9A-Fa-f]{6})$/)||s.match(/bgcolor/i)||(s+=" bgcolor="+e[n].value);break;case"border":"table"==t&&e[n].value.match(/^[1-5]{1}$/)&&(s+=" border="+e[n].value);break;case"align":case"valign":var g;"align"==e[n].name?(e[n].value.equals("middle")&&(e[n].value="center"),g=/^(center|left|right|justify|char)$/i):(e[n].value.equals("center")&&(e[n].value="middle"),g=/^(top|middle|bottom|baseline)$/i),i=e[n].value.trim().toLowerCase().match(g),i&&t.inArray(h)&&(s+=" "+e[n].name+"="+e[n].value);break;case"rowspan":case"colspan":!e[n].value.trim().match(/^[1-9][0-9]{0,2}$/)||"td"!=t&&"th"!=t||(s+=" "+e[n].name+"="+e[n].value)}return""!==d&&(s=s.replace(/=(?:(?:https?:\/\/(?:i1?\.ytimg|img\.youtube)\.com\/vi\/[a-zA-Z0-9-_]{11}\/hqdefault\.jpg)|(?:https?:\/\/(?:i2|i1|pic)\.bahamut\.com\.tw\/editor\/movie_pre\.gif))/,"="+d),t="movie"),("img"!=t||"img"==t&&o)&&(c="["+t+s+"]"+c),l+=a||""===c?"":"[/"+t+"]",{startTags:c,endTags:l}}function o(t,e,a){var n,o="",s="",c=["strike","del","blockquote","strong","big","em","dfn","var","cite","ins"],d=["s","s","tab","b","b","i","i","i","i","u"],f=i(c,d);t=f[t]||t;var m=["b","i","u","s","tab","center","h1","h2","h3","hr","li","ul","ol","table","td","tr","th","div","p"],g=i(m),v=g[t];v&&(o+="["+t+"]"),!a&&v&&(s+="[/"+t+"]");for(var b=0;b<e.length;b++)switch(e[b].name){case"href":if("a"==t){try{e[b].value=decodeURI(e[b].value)}catch(w){}e[b].value=e[b].value.replace(/\&amp;/g,"&"),e[b].value.match(/^http:\/\/acg\.gamer\.com\.tw\/search\.php\?encode=(?:utf8|big5)\&kw=(.+)/)?(o+="[acg]",s="[/acg]"+s):(n=e[b].value.trim().match(/^javascript:confirmLink\('(http[s]?:\/\/[\S]+?)'\)[;]?$/))?(o+="[url="+n[1]+"]",s="[/url]"+s):e[b].value.trim().match(/^http[s]?:\/\/.+?$/)&&(o+="[url="+e[b].value+"]",s="[/url]"+s)}break;case"color":var y=l(e[b].value);""!==y&&"font"==t&&(o+="[color="+y+"]",s="[/color]"+s);break;case"face":var k=e[b].value.replace(/'/g,"").split(/,/),x=i(p);"font"==t&&k.length>0&&x[k[0]]&&(o+="[font="+k[0]+"]",s="[/font]"+s);break;case"size":u.fontValue;"font"==t&&e[b].value.match(/^[1-7]$/)&&(o+="[size="+e[b].value+"]",s="[/size]"+s);break;case"align":n=e[b].value.trim().toLowerCase().match(/^(left|center|right)$/i);var C=i(h);n&&C[t]&&(o+="["+n[1]+"]",s="[/"+n[1]+"]"+s);break;case"style":if(!a){var _=r(e[b].value,t,!1);o+=_.startTags,s=_.endTags+s}}return{startTags:o,endTags:s}}function r(t,e,a){for(var n,o="",r="",c="",d=t.split(";"),f=0;f<d.length;f++)if(""!==d[f].trim()){var m=d[f].split(":"),g=m[0].trim().toLowerCase();if(m[1]){var v=m[1].trim().replace(/^["']([^"']+)["']$/,"$1"),b=v.split(/\s+/);if(0!==b.length)switch(g){case"color":case"background-color":var w="color"==g?"":"bg",y=l(v);""!==y&&("background-color"==g&&a?c+=" bgcolor="+y:e.inArray(["tr","tbody","table"])||(o+="["+w+"color="+y+"]",r="[/"+w+"color]"+r));break;case"font-family":var k=i(p),x=v.replace(/'/g,"").split(/,/);x.length>0&&k[x[0]]&&(o+="[font="+x[0]+"]",r="[/font]"+r);break;case"font-size":var C=u,_=i(C.size,C.fontValue);o+="[size="+_[s(b[0])]+"]",r="[/size]"+r;break;case"font-weight":"bold"==b[0].toLowerCase()&&(o+="[b]",r="[/b]"+r);break;case"font-style":var I=i(b);(I.italic||I.oblique)&&(o+="[i]",r="[/i]"+r);break;case"text-decoration":var T=i(b);T["line-through"]&&(o+="[s]",r="[/s]"+r),T.underline&&(o+="[u]",r="[/u]"+r);break;case"margin-left":if(n=[],n=b[0].match(/([0-9]{1,3})px/i)){var S=Math.ceil(parseInt(n[1],10)/40);if("div"==e)c+=" tab="+S;else for(var L=0;S>L;L++)o+="[tab]",r="[/tab]"+r}break;case"text-align":n=b[0].trim().toLowerCase().match(/(left|center|right)/i);var A=i(h);n&&A[e]&&(a?c+=" align="+n[1]:(o+="["+n[1]+"]",r="[/"+n[1]+"]"+r));break;case"vertical-align":n=b[0].trim().toLowerCase().match(/(top|middle|bottom)/i);var A=i(h);n&&A[e]&&a&&(c+=" valign="+n[1]);break;case"width":case"height":var j=s(v,!0);""!==j&&a&&(c+=" "+g+"="+j)}}}return{startTags:o,endTags:r,attribute:c}}function s(t,e){var a=15,n=0,o=["small","medium","large","x-large","xx-large"],r=["13px","15px","18px","24px","32px"];if(t.inArray(o,!0)){var s=i(o,r);return s[t.trim().toLowerCase()]}if(matches=t.match(/\s*([0-9]{0,3}(?:\.[0-9]{1,6})?)(%|px|pt|em|ex|pc|cm|mm|in)\s*/i)){if(matches[2].inArray(["%","em"],!0)&&e)return t;var l=parseFloat(matches[1]);if(!isNaN(l)){switch(matches[2]){case"%":n=c(l/100*a,6);break;case"px":n=l;break;case"pt":n=c(l/.75,6);break;case"em":n=l*a;break;case"ex":n=9.333333*l;break;case"pc":n=l*a;break;case"cm":n=c(37.795276*l,6);break;case"mm":n=c(3.779527*l,6);break;case"in":n=96*l}if(e)return c(n,0);for(var d=2147483647,p=0,h=u.size,f=0;f<h.length;f++){var m=parseFloat(h[f].substr(0,h[f].length-2));Math.abs(n-m)<d&&(d=Math.abs(n-m),p=f)}n=h[p]}}return 0===n?a+"px":n}function c(t,e){return multi=Math.pow(10,e),Math.round(t*multi)/multi}function l(t){var e,a=t;if((e=t.match(/\s*rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)\s*/i))||(e=t.match(/\s*rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*[0-9.]+\s*\)\s*/i))){var i=d(e[1]),n=d(e[2]),o=d(e[3]);a=0>i||0>n||0>o?"":"#"+i+n+o}return a}function d(t){var e="",a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],i=parseInt(t,10);if(isNaN(i)||0>i)return-1;for(;i>0;)e=a[i%16]+e,i=Math.floor(i/16);return""===e?e="00":1==e.length&&(e="0"+e),e}var p=["新細明體","細明體","標楷體","微軟正黑體","Arial","Arial Black","Comic Sans MS","Courier New","MS Mincho","Symbol","Tahoma","Times New Roman","Verdana"],u={label:["很小","小","中","大","很大","特大","超級大"],size:["10px","13px","15px","18px","24px","32px","48px"],fontValue:[1,2,3,4,5,6,7]},h=["div","p","h1","h2","h3","td","th","ol","ul","table"],f={code:["&nbsp;","&iexcl;","&quot;","&#39;","&amp;","&lt;","&gt;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&shy;","&reg;","&macr;","&deg;","&plusmn;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&times;","&divide;","&#8194"],value:[" ","¡",'"',"'","&","<",">","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","×","÷"," "]},m=1;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.equals=function(t,e){return e?this==t:this.trim().toLowerCase()==t.trim().toLowerCase()},String.prototype.inArray=function(t,e){var a=this;e&&(a=a.toLowerCase());for(var i=0;i<t.length;i++)if(e&&(t[i]=t[i].toLowerCase()),a==t[i])return!0;return!1},t.Bahacode=function(a){this.convert=function(){return a||(a=t.document.body),e(a)}}}(window);