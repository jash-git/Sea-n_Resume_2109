!function(s,e,t,i){function a(s,e,t,i){return this instanceof a?this.init(s,e,t,i):new a(s,e,t,i)}function l(s){t(".stickeredit_image .is-active").css("color",s)}function r(s){""==s?t(".stickeredit_image .is-active").css("-webkit-text-stroke",""):t(".stickeredit_image .is-active").css("-webkit-text-stroke","1px "+s)}function c(s){var e=s.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete e[0];for(var t=1;3>=t;++t)e[t]=parseInt(e[t]).toString(16),1==e[t].length&&(e[t]="0"+e[t]);return"#"+e.join("").toUpperCase()}function o(s,e){t(s.target).hasClass("edit-text")&&(t(".stickeredit_image .is-active").removeClass("is-active"),t(s.target).addClass("is-active")),t(s.target).is("span")&&(t(".stickeredit_image .is-active").removeClass("is-active"),t(s.target).parent().addClass("is-active"))}function d(s){var e="",t="",i=localStorage.hahamut_stickered||"[]";i=JSON.parse(i),t+='<div class="sticker-content"><ul class="sticker-list row">',i.forEach(function(e){var i=s.im.stickerDetail[e.sticker_group],a="";i&&(i.deadline>=(new Date).getTime()||0==i.deadline)&&(1==i.sticker_can_battle&&(a='<a class="sticker-list__edit" href="javascript:;" onclick="'+s.layout_id+".layout_u.showFightImgEdit('"+e.sticker_group+"', '"+e.sticker_img+"');\"></a>"),t+='<li class="sticker-list__item col-3 col-padding">  <a class="sticker-list__link" href="javascript:'+s.im_id+".sendSticker('"+e.sticker_group+"','"+e.sticker_img+'\');">    <img data-lazy="https://im.bahamut.com.tw/sticker%2F'+e.sticker_group+"%2F"+e.sticker_img+'.png?alt=media">  </a>  '+a+"</li>")}),t+="</ul></div>";var a=[];s.im.stickers.forEach(function(s,e){0!=s.sticker_visible&&a.push({key:e,sort:s.sticker_order+e/1e5})}),a.sort(function(s,e){return s.sort<e.sort?-1:1});for(var l in a){var r=a[l].key,c=s.im.stickerDetail[r];if(c){var o="",d="";if(1==c.sticker_can_battle&&(o="<span>戰</span>"),e+='<li class="tab-item" onclick="jQuery(\'[name=stickerContent]\').slick(\'slickGoTo\',jQuery(this).data(\'slick-index\'));">  <a name="slickitem" class="sticker-item" href="javascript:;">    <img src="https://im.bahamut.com.tw/sticker%2F'+r+"%2Fsticker_"+r+'.png?alt=media">    '+o+"  </a></li>",c.deadline>=(new Date).getTime()||0==c.deadline){t+='<div class="sticker-content"><ul class="sticker-list row">',c.stickers.forEach(function(e){1==c.sticker_can_battle&&(d='<a class="sticker-list__edit" href="javascript:;" onclick="'+s.layout_id+".layout_u.showFightImgEdit('"+r+"', '"+e+"');\"></a>"),t+='<li class="sticker-list__item col-3 col-padding">  <a class="sticker-list__link" href="javascript:'+s.im_id+".sendSticker('"+r+"','"+e+'\');">    <img data-lazy="https://im.bahamut.com.tw/sticker%2F'+r+"%2F"+e+'.png?alt=media">  </a>  '+d+"</li>"});var m="";c.sticker_link&&(m='    <div class="sticker-title__inner">相關連結： <a href="'+c.sticker_link.url+'" target="_blank">'+c.sticker_link.name+"</a></div>"),t+='  </ul>  <div class="sticker-title">    <div class="sticker-title__inner">貼圖名稱： '+c.sticker_group_name+'</div>    <div class="sticker-title__inner">貼圖期限： '+(0==c.deadline?"永久":n(c.deadline-1,"sticker"))+'</div>    <div class="sticker-title__inner">貼圖作者： '+("官方提供"==c.sticker_author||"sysop"==c.sticker_author?"官方提供":'<a href="https://home.gamer.com.tw/'+c.sticker_author+'" target="_blank">'+c.sticker_author+"</a>")+"</div>    "+m+"  </div></div>"}else t+='<div class="sticker-content">  <div class="sticker-status">    <p>貼圖期限於 '+n(c.deadline-1,"sticker_dealine")+' 過期，已無法使用。</p>    <button type="" class="mes-btn mes-btn-primary" onclick="'+s.im_id+".clearSticker('"+r+"');\">刪除</button>  </div></div>"}}return'<div class="sticker-wrapper">  <div class="sticker-nav group">    <ul class="tab-nav mes-sticker-slide" id="sticker_index">    <li class="tab-item" onclick="jQuery(\'[name=stickerContent]\').slick(\'slickGoTo\',jQuery(this).data(\'slick-index\'));">      <a name="slickitem" class="sticker-item is-active" href="javascript:;">        <i class="material-icons">access_time</i>      </a>    </li>    '+e+'    </ul>    <button type="" class="btn-icon" onclick="'+s.layout_id+'.editSticker();"><i class="material-icons">settings</i></button>  </div>  <div name="stickerContent">    '+t+"  </div></div>"}function n(s,e){if(0==s)return"";var t=new Date,i=new Date(s),a=i.getFullYear(),l=t.getFullYear(),r=i.getMonth()+1,c=t.getMonth()+1,o=i.getDate(),d=t.getDate(),n=i.getHours(),m=i.getMinutes(),u=i.getSeconds();switch(10>r&&(r="0"+r),10>o&&(o="0"+o),10>c&&(c="0"+c),10>d&&(d="0"+d),10>n&&(n="0"+n),10>m&&(m="0"+m),10>u&&(u="0"+u),e){case"note":var v=r+"/"+o+" "+n+":"+m;break;case"sticker":var v=a+"/"+r+"/"+o;break;case"sticker_dealine":var v=a+"年"+r+"月"+o+"日";break;default:if(l==a&&c==r&&d==o)var v=n+":"+m;else if(l==a)var v=r+"/"+o;else var v=a+"/"+r+"/"+o}return v}function m(s){return s?s.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\n","\n<br>").replaceAll(/https?:\/\/[^\s"']+/,function(s){return/^https:\/\/.+?\.(?:jpe?g|gif|png)(?:\?alt=media|)$/i.test(s)?_("a",{href:s,target:"_blank"},"img",_("img",{src:s,"data-img":"true","data-height":"0",style:"max-width:100%;max-height:400px"})):_("a",{href:s,target:"_blank"},"text",s)}):""}function u(s){return s?s.replaceAll("<","&lt;").replaceAll(">","&gt;"):""}function v(s,e){if(s){var t=new RegExp("^bot@"),i=new RegExp("^fans@");if(t.test(s))return"S"==e?"https://im.bahamut.com.tw/bot%2F"+s+"_s.png?alt=media":"https://im.bahamut.com.tw/bot%2F"+s+".png?alt=media";if(i.test(s)&&!i.test(firebase.auth().currentUser.uid)){if(s>firebase.auth().currentUser.uid)var a=firebase.auth().currentUser.uid+"_"+s;else var a=s+"_"+firebase.auth().currentUser.uid;var l=h(self.im.rooms,a);return self.im.roomData[l].photo}return s=s.toLowerCase(),"S"==e?"https://avatar2.bahamut.com.tw/avataruserpic/"+s.substr(0,1)+"/"+s.substr(1,1)+"/"+s+"/"+s+"_s.png":"https://avatar2.bahamut.com.tw/avataruserpic/"+s.substr(0,1)+"/"+s.substr(1,1)+"/"+s+"/"+s+".png"}}function p(s){if(!s)return"javascript:;";var e=new RegExp("^[a-zA-Z]{1}[a-zA-Z0-9]{1,11}$"),t=new RegExp("^bot@"),i=new RegExp("^fans@");return e.test(s)?"https://home.gamer.com.tw/"+s:t.test(s)?"bot@blackdesertm"==s?"https://prj.gamer.com.tw/2018/blackdesertm/":"javascript:;":i.test(s)?"javascript:;":void 0}function h(s,e){var t=!1;return s.some(function(s,i){return s==e?(t=i,!0):!1}),t}function _(s,i,a,l){var r=e.createElement(s);return t.each(i,function(s,e){r.setAttribute(s,e)}),"undefined"!=typeof l&&("text"==a?t(r).text(l):t(r).html(l)),r.outerHTML}function g(s,e,a){var l=e.roomId,r=h(a.im.rooms,l);if("im_forum"==a.im_id)var c="message-scoller_forum",o="data-forum_time";else var c="message-scoller",o="data-time";if((e.timestamp>a.im.roomData[r].last_read_time||a.im.roomData[r].last_read_time==i)&&0==t("#noread").size()&&t("#"+c).append('<div class="mes-state-tip" id="noread"><div class="mes-state-tip__block"><i class="material-icons">weekend</i><span>以下需要尬廣跟上</span><span data-stop="true"></span></div></div>'),"im_forum_layout"!=a.layout_id)var d="<a class=mes-tooltip--link href=javascript:; onclick="+a.layout_id+".sendToOther('"+s+"');>轉傳</a>";else d="";2==a.im.roomInfo[r].type&&e.sender_id!=firebase.auth().currentUser.uid?d+="<a class=mes-tooltip--link href=javascript:; onclick="+a.layout_id+".accuse('"+s+"');>檢舉</a>":2!=a.im.roomInfo[r].type&&4!=a.im.roomInfo[r].type&&0==e.type&&(d+="<a class=mes-tooltip--link href=javascript:; onclick="+a.layout_id+".noteAdd('"+s+"');>儲存到記事本</a>");var g="";switch(e.type){case 0:g='<div class="message-log__item group">  <div class="msg-log">'+m(e.message)+'</div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" data-hastip="true" class="btn-icon" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>';break;case 1:var k="",f="";if(e.thumbnail)k=e.thumbnail,f=e.thumbnail;else{var y="jpg";e.image_ext&&(y=e.image_ext),e.image_id?(f="https://im.bahamut.com.tw/chatimg%2Fthumb_"+e.image_id+".jpg?alt=media",k="https://im.bahamut.com.tw/chatimg%2F"+e.image_id+"."+y+"?alt=media"):(f="https://im.bahamut.com.tw/room%2Fchat_image%2F"+l+"%2Fthumb_"+s+".jpg?alt=media",k="https://im.bahamut.com.tw/room%2Fchat_image%2F"+l+"%2F"+s+"."+y+"?alt=media")}g='<div class="message-log__item group">  <div class="msg-log msg-log--photo">'+_("a",{href:k,target:"_blank"},"img",_("img",{src:f,onerror:"this.src='"+k+"';this.onerror=''","data-img":"true","data-height":"0"}))+'  </div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" class="btn-icon" data-hastip="true" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>';break;case 2:g='<div class="message-log__item group">  <div class="msg-log msg-log--sticker">'+_("img",{src:"https://im.bahamut.com.tw/sticker%2F"+e.sticker_group_id+"%2F"+e.sticker_id+".png?alt=media","data-img":"true","data-height":"0"})+"  </div></div>";break;case 4:g='<div class="mes-state-tip" '+o+'="'+e.timestamp+'">'+_("div",{"class":"mes-state-tip__inline"},"text",b(e))+"</div>";break;case 7:var x,w,j,F,Q,C,T=JSON.parse(e.events),S='<svg class="ic-sword" width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>ic_sword</title><path d="M3.41152954,0.00422515905 L3.4157547,-3.82804899e-13 L15.1544945,11.7387398 L15.8932343,11 L17.9234238,13.0301895 L16.6066208,14.3469925 L18.635582,16.3759536 L19.009964,16.0015717 L20.0457458,17.0373535 L17.0326996,20.0503998 L15.9969177,19.0146179 L16.3759536,18.635582 L14.3469925,16.6066208 L13.0301895,17.9234238 L11,15.8932343 L11.7387398,15.1544945 L0.00247497486,3.41822967 L0,3.41822967 L0,-8.8817842e-16 L3.41152954,-8.8817842e-16 L3.41152954,0.00422515905 Z" id="ic_sword"></path></svg>',E='<svg class="ic-shield" width="20px" height="22px" viewBox="3 0 18 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>ic_shield</title><path d="M12,1 L3,5 L3,11 C3,16.55 6.84,21.74 12,23 C17.16,21.74 21,16.55 21,11 L21,5 L12,1 Z" id="ic_shield"></path></svg>';x=T[0].effects[firebase.auth().currentUser.uid]!=i?firebase.auth().currentUser.uid:T[0].atter;for(var r in T[0].effects)r!=x&&(F=r,"att"==T[0].effects[r]?(Q=S,w=E):(Q=E,w=S));for(var r in T)2==T[r].battle_type&&(j=T[r].effects[x],C=T[r].effects[F]);g='<div class="mes-pk-poster-box" id="pk_'+s+'" '+o+'="'+e.timestamp+'">  <div class="mes-pk-poster">    <div class="mes-pk-poster__item author-avatar" '+("win"==C?'data-pkwin="1"':"")+'>      <div class="pk-award">        <img src="https://im.bahamut.com.tw/hahamut%2Fic_award.png?alt=media">      </div>'+_("img",{src:v(F,"B")})+'      <div class="pk-states pk-states--l">'+Q+'</div>    </div>    <div class="mes-pk-poster__item">VS.</div>    <div class="mes-pk-poster__item author-avatar" '+("win"==j?'data-pkwin="1"':"")+'>      <div class="pk-award">        <img src="https://im.bahamut.com.tw/hahamut%2Fic_award.png?alt=media">      </div>'+_("img",{src:v(x,"B")})+'      <div class="pk-states pk-states--r">'+w+'</div>    </div>  </div>  <div class="mes-pk-poster-tool">    <button type="button" class="mes-btn" onclick="'+a.layout_id+".startPK("+a.im_id+".msgData['"+s+'\'],0)">      <i class="material-icons">play_arrow</i>      觀看過程    </button>    <button type="button" class="mes-btn" onclick="jQuery(\'#pk_'+s+" [data-pkwin]').addClass('pk-winner')\">      <i class=\"material-icons\">format_list_bulleted</i>      對戰結果    </button>  </div></div>";break;case 8:g='<div class="message-log__item group">  <div class="msg-log msg-log--sticker">    <canvas id="fightImg_'+s+'"></canvas>    <script>'+a.layout_id+".showFightImg('"+s+"');</script>  </div></div>";break;case 9:g='<div class="message-log__item group">  <div class="msg-log">'+m("想和"+e.sender_name+"進行互動，請至『哈哈姆特不EY APP』上進行操作!\nhttps://prj.gamer.com.tw/app2u/hahaapp.html")+'</div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" data-hastip="true" class="btn-icon" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>'}if(""!=g){if(4==e.type||7==e.type)return g;var D=v(e.sender_id,"S");if(e.sender_id==firebase.auth().currentUser.uid){var M="message-holder msg-rtl";5==e.type&&(M+=" msg-pk-rtl")}else{var M="message-holder";5==e.type&&(M+=" msg-pk")}var A='<div class="'+M+'" '+o+'="'+e.timestamp+'">  <div class="user-avatar message-icon">'+_("a",{href:p(e.sender_id),target:"_blank","data-gamercard-userid":e.sender_id,"class":"gamercard"},"div",_("div",{"class":"user-avatar__img",style:"background-image: url("+D+');"'}))+'  </div>  <div class="message-log">    <div class="message-log__header group">      <h4 class="msg-log-title">'+u(e.sender_name||e.sender_id)+' -</h4>      <div class="msg-log-time">'+n(e.timestamp)+"</div>    </div>"+g+"  </div></div>";return A}}function b(s){switch(s.system_message_type){case 0:rmsg=s.system_message_actor+" 加入群組";break;case 1:rmsg=s.system_message_actor+" 退出群組";break;case 2:rmsg=s.system_message_actor+" 建立群組";break;case 3:rmsg=s.system_message_actor+" 更新群組圖片";break;case 4:rmsg=s.system_message_actor+" 更新群組名稱";break;case 5:rmsg=s.system_message_actor+" 邀請了 "+s.system_message_receiver;break;case 6:rmsg=s.system_message_actor+" 把 "+s.system_message_receiver+"踢出群組";break;case 7:rmsg=s.system_message_text;break;case 8:rmsg=s.system_message_actor+" 更新群組相關作品"}return rmsg}a.prototype.init=function(s,e,t,i){this.im=s,this.layout=t,this.im_id=e,this.layout_id=i,this.tip=null,this.tip2=[]},a.prototype.showNoRead=function(s){var e=s.noreadnum;return 2==s.type?e>0?"New":"":e>999?"999+":e>0?e:""},a.prototype.showFightImg=function(s){var e=this,i=this.im.msgData[s],a=new Image;a.onload=function(){var l=t("#fightImg_"+s),r=l.parent().parent().parent().parent().parent().scrollTop();a.width>=a.height?(l.attr("width",a.height/.875).attr("height",a.height).css("max-width","100%"),ctx=l.get(0).getContext("2d"),ctx.drawImage(a,(a.height/.875-a.width)/2,0)):(l.attr("width",a.width).attr("height",.875*a.width).css("max-width","100%"),ctx=l.get(0).getContext("2d"),ctx.drawImage(a,0,(.875*a.width-a.height)/2)),(l.parent().parent().parent().parent().position().top<0||1==e.layout.isDown)&&l.parent().parent().parent().parent().parent().scrollTop(r+l.height()-150);var c=JSON.parse(i.text_data);c.forEach(function(s){var e=s.text_size*l.get(0).height*.99,t=s.text_position_x*l.get(0).width,i=s.text_position_y*l.get(0).height;ctx.setTransform(1,0,0,1,0,0),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="bold "+e+"px Microsoft JhengHei";for(var a=s.text.split(""),r=[],c="",o=0,d=0;d<a.length;d++)ctx.measureText(c+a[d]).width<=l.get(0).width&&"\n"!=a[d]?c+=a[d]:(ctx.measureText(c).width>o&&(o=ctx.measureText(c).width),r.push(c.replace("\n","")),c=a[d]);r.push(c.replace("\n","")),ctx.measureText(c).width>o&&(o=ctx.measureText(c).width),ctx.translate(t+o/2,i+e*r.length/2),ctx.rotate(Math.PI/180*s.text_angle),ctx.translate(-o/2,-e*r.length/2);for(var d=0;d<r.length;d++){var o=ctx.measureText(r[d]).width;ctx.fillStyle=s.text_color,ctx.fillText(r[d],o/2,e/2+1.19*e*d),1==s.text_has_stroke&&(ctx.strokeStyle=s.text_stroke_color,ctx.strokeText(r[d],o/2,e/2+1.19*e*d))}})},a.src="https://im.bahamut.com.tw/sticker%2F"+i.sticker_group_id+"%2F"+i.sticker_id+".png?alt=media"},a.prototype.avatarUrl=function(s,e){return v(s,e)},a.prototype.avatarLink=function(s){return p(s)},a.prototype.addMember=function(){var s=this.im.roomInfo[this.im.nowRoom],e='<h3 class="modal__header--title">邀請成員</h3>',i="<div class=\"modal-content\">  <ul class=\"tab-nav removeTextNodes\">    <li class=\"tab-item is-active\">      <a href=\"javascript:;\" onclick=\"jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));\">邀請好友</a>    </li>";s.is_public===!0&&(i+="    <li class=\"tab-item\">      <a href=\"javascript:;\" onclick=\"jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));\">行動條碼</a>    </li>    <li class=\"tab-item\">      <a href=\"javascript:;\" onclick=\"jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));\">邀請網址</a>    </li>"),i+='    <li class="tab-item">      <a href="javascript:;" onclick="jQuery(\'.tab-item.is-active\').removeClass(\'is-active\');jQuery(this).parent().addClass(\'is-active\');jQuery(\'#addMemberSlick\').slick(\'slickGoTo\',jQuery(this).parent().parent().find(\'li\').index(jQuery(this).parent()));">搜尋 ID</a>    </li>  </ul>  <div id="addMemberSlick">  <div class="tab-box" id="addMemberTabFriend">    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_favorite\',this);">          <div class="message-room-subname">最愛</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_favorite">        </ul>      </li>    </ul>    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_normal\',this);">          <div class="message-room-subname">一般</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_normal">        </ul>      </li>    </ul>    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_1vs1\',this);">          <div class="message-room-subname">私訊過</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_1vs1">        </ul>      </li>    </ul>  </div>',s.is_public===!0&&(i+='  <div class="tab-box" id="addMemberTabQr">    <div class="invite-box">      <div class="invite__qr-code">      </div>      <script>jQuery(\'.invite__qr-code\').qrcode({width:224,height:224,text:"https://haha.gamer.com.tw/index.php?room='+this.im.rooms[this.im.nowRoom]+'"});</script>      <a class="mes-btn mes-btn-default" href="#" download="'+this.im.rooms[this.im.nowRoom]+'.png" onclick="this.href=jQuery(\'.invite__qr-code > canvas\').get(0).toDataURL();">下載</a>    </div>  </div>  <div class="tab-box">    <div class="invite-box">      <div class="invite__link">        <input type="text" class="mes-textbox" value="https://haha.gamer.com.tw/?room='+this.im.rooms[this.im.nowRoom]+"\" id=\"linkurl\"/>      </div>      <button class=\"mes-btn mes-btn-default\" onclick=\"jQuery('#linkurl').select();if(document.execCommand('copy')){jQuery(this).html('已複製到剪貼簿');}else{jQuery(this).html('複製失敗，請手動複製上面網址');};\">>複製網址</button>    </div>  </div>"),i+='  <div class="tab-box">    <div class="modal-search-box">      <input type="text" class="mes-textbox"/>      <button class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.addMemberSearchBahaid(jQuery(this).prev(\'input\').val());">搜尋</button>    </div>    <div class="modal-result-box" style="display:none" id="searchBahaid">      <div class="invite-box">        <div class="invite__author">          <a href="" target="_blank" class="author-avatar" id="searchBahaid_avatar">            <img src="" alt=""/>          </a>          <div class="author-username">            <p class="name" id="searchBahaid_name"></p>            <a class="id" id="searchBahaid_link" href="" target="_blank"></a>          </div>          <button class="mes-btn mes-btn-invese" onclick="'+this.im_id+".addMember(jQuery('#searchBahaid_link').html(),jQuery('#searchBahaid_name').html());jQuery(this).hide();jQuery(this).next('p').show();\">邀請</button>          <p class=\"invite-tip__text\" style=\"display:none\">邀請已傳送！</p>        </div>      </div>    </div>  </div>  </div></div>";var a='<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close()">取消</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+".addMembers(jQuery('[name=mes-checkbox]:checked'));\">邀請</a></div>";this.layout.lightbox=jQuery().lightBox({header:e,body:i,footer:a}),this.layout.lightbox.open(),jQuery("#addMemberSlick").slick({arrows:!1,draggable:!1,infinite:!1}).on("beforeChange",function(s,e,t,i){0==i?jQuery(".modal__footer").show():jQuery(".modal__footer").hide()}).find('input[type="text"]').click(function(){var s=t(this),e="static";s.css({position:"relative"}),setTimeout(function(){s.focus(),s.css({position:e})},0)}),this.addMemberSearchFriend("")},a.prototype.addMemberSearchFriend=function(s){async.series([function(s){this.im.getAllChatList(!0,s)}],function(){jQuery("#addMember_favorite").html(""),jQuery("#addMember_normal").html("");for(var e in this.im.rooms){var t=this.im.roomData[e];if(3==t.type){var i="",a="";for(var l in t.members)l!=firebase.auth().currentUser.uid&&(i=l,a=t.members[l].name);if(""==s||null!=i.match(s)||null!=t.name.match(s)){if(t.is_favorite===!0&&t.is_friend!==!1)var r=jQuery("#addMember_favorite");else if(t.is_friend!==!1)var r=jQuery("#addMember_normal");else{if(t.is_friend!==!1||t.has_chat!==!0)continue;var r=jQuery("#addMember_1vs1")}var c='<li class="message-room-list__item">  <div class="user-panel dense data">    <div class="user-ctrl">      <div class="mes-checkbox">        <label class="mes-checkbox__label">          <input type="checkbox" name="mes-checkbox" value="'+i+'" data-nick="'+a+'">          <div class="mes-checkbox__button"></div>        </label>      </div>    </div>    <div class="user-avatar">      <div class="user-avatar__img" style="background-image: url('+v(i,"S")+');"></div>    </div>    <div class="user-container">      <div class="user-header">        <div class="user-title">          <span class="user-name">'+u(this.im.roomData[e].name)+'</span>        </div>      </div>      <div class="user-body">        <div class="message-summary">          <span>'+i+"</span>        </div>      </div>    </div>  </div></li>";r.append(c)}}}})},a.prototype.groupAdd_header=function(){return'<h3 class="modal__header--title">建立群組</h3>'},a.prototype.groupEdit_header=function(){return'<h3 class="modal__header--title">編輯群組</h3>'},a.prototype.groupAdd_body=function(){return'<div class="modal-content">  <ul class="fields">    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">群組圖片：</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-group-img-pre">        <img id="upimg">        </div>        <div class="mes-filebox">          <span>上傳圖片</span>          <input type="file" class="mes-filebox__pre" onchange="jQuery(\'.modal__body\').slick(\'slickGoTo\',1);'+this.im_id+'.readFile(this)"/>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">群組名稱：</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-fields">          <input type="text" class="mes-textbox" name="group-name" value="" onkeyup="jQuery(this).next(\'span\').html( jQuery(this).val().length + \'/40\' );" placeholder="群組名稱"/>          <span class="mes-fields__tips">0/40</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">相關作品：</div>      <div class="fields-value col-10 col-wm-12">        <div class="relative-hlp">          <div class="mes-fields-value__text" name="group_relgame_span">尚未設定</div>          <input type="hidden" value="0" name="group-c1" />          <input type="hidden" value="" name="group-relgame" />          <button class="mes-btn mes-btn-default" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',2);">設定</button>          <span class="mes-fields__tips"><i class="material-icons">info_outline</i>有關聯作品並公開的聊天室，會在對應的哈啦板曝光</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">聊天室設定：</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="1" checked>            <div class="mes-radio__button"></div>            公開          </label>        </div>        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="2">            <div class="mes-radio__button"></div>            私密          </label>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">邀請好友：</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-fields-value__text" id="group_add_inviting_num">已選擇 0 人</div>        <button class="mes-btn mes-btn-default" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',3);">選擇好友</button>        <div class="avatar-box inline removeTextNodes" id="group_add_inviting"></div>      </div>    </li>  </ul></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);">      <i class="material-icons">keyboard_arrow_left</i>      <span class="mes-btn-txt">返回</span>    </a>    <div class="modal__sub-title">      裁切圖片    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);jQuery(\'#upimg\').attr(\'src\',jQuery(\'#dimg\').attr(\'src\'));">完成</a>  </div>  <div class="group-setting-content">    <div id="simg" style="float:left;width:300px"></div>    <img id="dimg" style="float:right;">  </div></div><div class="modal-content">  <div class="modal__sub-header">    <div class="modal__sub-title">      搜尋相關作品    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);">完成</a>  </div>  <div class="group-setting-content">    <div class="modal-search-box">      <input type="text" class="mes-textbox" id="group_search_key">      <button class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.searchRelatedC1();">搜尋</button>    </div>    <div class="modal-result-box">      <div class="game-select removeTextNodes">        <div class="game-select__result">          目前選取作品：<span class="has-data" name="group_relgame_span">未選取</span>        </div>        <button class="mes-btn mes-btn-small mes-btn-default" onclick="jQuery(\'[name=group_relgame_span]\').html(\'未選取\');jQuery(\'[name=group-relgame]\').val(\'\');jQuery(\'\').val(0);">清除</button>      </div>      <ul class="game-result" id="group_relgame_search_list">      </ul>    </div>  </div></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);">      <span class="mes-btn-txt">取消</span>    </a>    <div class="modal__sub-title">      邀請好友    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);'+this.layout_id+'.groupAddSetInviting();">邀請</a>  </div>  <div class="group-setting-content">    <div class="modal-result-box" style="height:500px;overflow:auto">      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_favorite\',this);">            <div class="message-room-subname">最愛</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_favorite">          </ul>        </li>      </ul>      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_normal\',this);">            <div class="message-room-subname">一般</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_normal">          </ul>        </li>      </ul>      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+'.listSlide(\'addMember_1vs1\',this);">            <div class="message-room-subname">私訊過</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_1vs1">          </ul>        </li>      </ul>    </div>  </div></div>'},a.prototype.groupEdit_body=function(s){var e=this.im.roomInfo[s],t=this.im.roomData[s];return'<div class="modal-content">  <ul class="fields">    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">群組圖片：</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-group-img-pre">          <img src="'+t.photo+'" alt="" id="upimg"/>        </div>        <div class="mes-filebox">          <span>重新上傳</span>          <input type="file" class="mes-filebox__pre" onchange="jQuery(\'.modal__body\').slick(\'slickGoTo\',1);im.readFile(this)"/>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">群組名稱：</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-fields">          <input type="text" class="mes-textbox" name="group-name" value="'+e.name+'" onkeyup="jQuery(this).next(\'span\').html( jQuery(this).val().length + \'/40\' );" placeholder="群組名稱"/>          <span class="mes-fields__tips">'+e.name.length+'/40</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">相關作品：</div>      <div class="fields-value col-10 col-wm-12">        <div class="relative-hlp">          <div class="mes-fields-value__text" name="group_relgame_span">'+u(e.related_acg_name)+'</div>          <input type="hidden" value="'+e.related_c1+'" name="group-c1" />          <input type="hidden" value="'+e.related_acg_name+'" name="group-relgame" />          <button class="mes-btn mes-btn-default" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',2);">設定</button>          <span class="mes-fields__tips"><i class="material-icons">info_outline</i>有關聯作品並公開的聊天室，會在對應的哈啦板曝光</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">聊天室設定：</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="1" '+(e.is_public?"checked":"")+'>            <div class="mes-radio__button"></div>            公開          </label>        </div>        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="2" '+(e.is_public?"":"checked")+'>            <div class="mes-radio__button"></div>            私密          </label>        </div>      </div>    </li>  </ul></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);">      <i class="material-icons">keyboard_arrow_left</i>      <span class="mes-btn-txt">返回</span>    </a>    <div class="modal__sub-title">      裁切圖片    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);jQuery(\'#upimg\').attr(\'src\',jQuery(\'#dimg\').attr(\'src\'));">完成</a>  </div>  <div class="group-setting-content">    <div id="simg" style="float:left;width:300px"></div>    <img id="dimg" style="float:right;">  </div></div><div class="modal-content">  <div class="modal__sub-header">    <div class="modal__sub-title">      搜尋相關作品    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery(\'.modal__body\').slick(\'slickGoTo\',0);">完成</a>  </div>  <div class="group-setting-content">    <div class="modal-search-box">      <input type="text" class="mes-textbox" id="group_search_key">      <button class="mes-btn mes-btn-primary" onclick="im.searchRelatedC1();">搜尋</button>    </div>    <div class="modal-result-box">      <div class="game-select removeTextNodes">        <div class="game-select__result">          目前選取作品：<span class="has-data" name="group_relgame_span">'+u(e.related_acg_name)+"</span>        </div>        <button class=\"mes-btn mes-btn-small mes-btn-default\" onclick=\"jQuery('[name=group_relgame_span]').html('未選取');jQuery('[name=group-relgame]').val('');jQuery('').val(0);\">清除</button>      </div>      <ul class=\"game-result\" id=\"group_relgame_search_list\">      </ul>    </div>  </div></div>";
},a.prototype.groupAdd_foot=function(){return'<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close();">取消</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.groupAdd()">新增</a></div>'},a.prototype.groupEdit_foot=function(){return'<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close();">取消</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.groupEdit()">儲存</a></div>'},a.prototype.editSticker=function(){var s=this,e='<div class="modal-content modal-content--h-limit">  <div class="modal__sub-header">    <div class="modal-sub-ctrl-rtl">      全選<div class="mes-switch padding-both">        <label class="mes-switch__label">          <input type="checkbox" name="mes-switch" onchange="'+this.im_id+'.editSticker(\'all\',this);">          <div class="mes-switch__button"></div>        </label>      </div>    </div>  </div>  <ul class="message-room-list">',t=" is-disable",i=[];this.im.stickers.forEach(function(s,e){0==s.sticker_visible?i.push({key:e,sort:1e5+e/1e5}):i.push({key:e,sort:s.sticker_order+e/1e5})}),i.sort(function(s,e){return s.sort<e.sort?-1:1});for(var a in i){var l=i[a].key,r=this.im.stickers[l],c=this.im.stickerDetail[l];c&&(c.deadline<(new Date).getTime()&&0!=c.deadline&&(t=""),e+='<li class="message-room-list__item">  <div class="user-panel dense data">    <div class="user-avatar user-avatar--square">      <div class="user-avatar__img" style="background-image: url(https://im.bahamut.com.tw/sticker%2F'+l+"%2Fsticker_"+l+'.png?alt=media);"></div>    </div>    <div class="user-container">      <div class="user-header">        <div class="user-title">          <span class="user-name">'+c.sticker_group_name+'</span>        </div>      </div>      <div class="user-body">        <div class="message-summary">          <span>貼圖期限：'+(0==c.deadline?"永久":n(c.deadline-1,"sticker_dealine"))+'</span>        </div>      </div>    </div>    <div class="user-ctrl">      <div class="mes-switch">        <label class="mes-switch__label">          <input type="checkbox" name="mes-switch" onchange="'+this.im_id+".editSticker('"+l+"',this);\" "+(0==r.sticker_visible?"":"checked")+'>          <div class="mes-switch__button"></div>        </label>      </div>    </div>  </div></li>')}e+="</ul></div>",this.layout.lightbox&&this.layout.lightbox.close(),this.layout.lightbox=jQuery().lightBox({header:'<h3 class="modal__header--title">選擇要顯示的貼圖</h3>',body:e,footer:'<a href="javascript:;" class="mes-btn mes-btn-link'+t+'" onclick="'+this.im_id+".clearSticker('all');\">清除所有過期貼圖</a>",footerClass:"modal__footer--general"}),setTimeout(function(){s.layout.lightbox.open()},200)},a.prototype.updateSticker=function(s){null!=this.tip&&(this.tip.destroyAll(),this.tip2.forEach(function(s){s.destroyAll()}))},a.prototype.changeStickerFans=function(s){t("a[data-sticker-group]").hide(),t("a[data-sticker-group="+s+"]").each(function(s,e){t(e).find("img").attr("src",t(e).find("img").attr("data-src"))}),t("a[data-sticker-group="+s+"]").show()},a.prototype.showStickerFans=function(){var s=this,e="",t=localStorage.hahamut_stickered||"[]";t=JSON.parse(t),t.forEach(function(t){e+='<a data-sticker-group="0" href="javascript:'+s.im_id+".sendSticker('"+t.sticker_group+"','"+t.sticker_img+"');$('.btn-emotion-active').click();\">  <img src=\"https://im.bahamut.com.tw/sticker%2F"+t.sticker_group+"%2F"+t.sticker_img+'.png?alt=media" class="emotion-img"></a>'});var i=[];s.im.stickers.forEach(function(s,e){0!=s.sticker_visible&&i.push({key:e,sort:s.sticker_order+e/1e5})}),i.sort(function(s,e){return s.sort<e.sort?-1:1});var a='<a href="javascript:;" onclick="'+s.layout_id+'.layout_u.changeStickerFans(0)"><i class="emotion-item material-icons" style="font-size:48px">access_time</i></a>';for(var l in i){var r=i[l].key,c=s.im.stickerDetail[r];if(c&&!(c.deadline<(new Date).getTime()&&0!=c.deadline)){a+='<a href="javascript:;" onclick="'+s.layout_id+".layout_u.changeStickerFans("+r+')"><img src="https://im.bahamut.com.tw/sticker%2F'+r+"%2Fsticker_"+r+'.png?alt=media" alt="img" class="emotion-item"></a>';for(var o in c.stickers)e+='<a data-sticker-group="'+r+'" href="javascript:'+s.im_id+".sendSticker('"+r+"','"+c.stickers[o]+'\');$(\'.btn-emotion-active\').click();" style="display:none">  <img data-src="https://im.bahamut.com.tw/sticker%2F'+r+"%2F"+c.stickers[o]+'.png?alt=media" class="emotion-img"></a>'}}return'<div class="emotion-area">'+e+'</div><div class="emotion-option">'+a+"</div>"},a.prototype.showSticker=function(s){var a=this;if(t(s).attr("data-tooltipped")==i){var l=e.createElement("div");l.innerHTML=d(a),a.tip=tippy(s,{theme:"default",html:l,arrow:!0,trigger:"click",interactive:!0,animation:"fade",onShow:function(){t(this).find("[name=stickerContent]").show(),t(this).find("[name=stickerContent]").slick({lazyLoad:"ondemand",arrows:!1,draggable:!1,infinite:!1,fade:!0}),t(this).find("[name=stickerContent]").on("beforeChange",function(s,e,i,a){t("[name=slickitem]").removeClass("is-active"),t("[name=slickitem]:eq("+a+")").addClass("is-active")}),t(this).find("[name=stickerContent]").on("lazyLoaded",function(s,t,i,l){var r=e.createElement("img");r.src=l,r.width=180,a.tip2.push(tippy(i[0],{html:r,arrow:!0,animation:"fade",theme:"light"}))})},onShown:function(){var s=6;t(this).find("#sticker_index li").size()<6&&(s=t(this).find("#sticker_index li").size()),t(this).find("#sticker_index").slick({infinite:!1,slidesToShow:s,slidesToScroll:s,asNavFor:"[name=stickerContent]"}),t(this).find("[name=stickerContent]").slick("setPosition"),t(this).find("#sticker_index").slick("setPosition")},onHide:function(){t(this).find("[name=stickerContent]").hide(),t(this).find("[name=stickerContent]").slick("unslick"),t(this).find("#sticker_index").slick("unslick")}});var r=t(s).get(0),c=a.tip.getPopperElement(r);a.tip.show(c)}},a.prototype.createHtml=function(s,e,t,i){return _(s,e,t,i)},a.prototype.msgContent=function(s,e){return g(s,e,this)},a.prototype.showFightImgEdit=function(s,e){var i=this,a='<div class="stickeredit_image" id="stickerDiv" style="z-index:1">  <img src="https://im.bahamut.com.tw/sticker%2F'+s+"%2F"+e+'.png?alt=media"></div><div class="stickeredit_edit" style="z-index:1">  <div class="scroll-hidden text_input">    <textarea id="stickerText" class="stickeredit text_input" placeholder="輸入戰圖文字">早安，認同請分享</textarea>  </div>  <div class="tool-icon">    <button type="bottom" class="add-name" id="addNick">加入暱稱</button>    <div class="icons">      <a id="addText" class="add-text" href="javascript:;" alt="新增文字"></a>      <a id="deleteText" class="delete-text" href="javascript:;" alt="刪除文字"></a>    </div>  </div>  <div class="tabs">    <div class="tab">      <input type="radio" name="tabs" id="tab1" checked="checked">      <label for="tab1">填色</label>      <div class="tickets-tab-content">        <div class="color-ticket">          <div class="coloring">            <div class="color-item">              <span class="white" style="background: #FFFFFF;"></span>              <span style="background: #747D7E"></span>              <span style="background: #000000"></span>            </div>            <div class="color-item">              <span style="background: #F7C3C7"></span>              <span style="background: #E84341"></span>              <span style="background: #8A1712"></span>            </div>            <div class="color-item">              <span style="background: #FFEDC5"></span>              <span style="background: #F3942E"></span>              <span style="background: #8D4A15"></span>            </div>            <div class="color-item">              <span style="background: #FBF7C7"></span>              <span style="background: #F9EB30"></span>              <span style="background: #8D7F1C"></span>            </div>            <div class="color-item">              <span style="background: #D8EAD0"></span>              <span style="background: #7ABC62"></span>              <span style="background: #247B34"></span>            </div>            <div class="color-item">              <span style="background: #C8E6EE"></span>              <span style="background: #4CBFBF"></span>              <span style="background: #019BAD"></span>            </div>            <div class="color-item">              <span style="background: #C6E0F7"></span>              <span style="background: #4A87C6"></span>              <span style="background: #08468F"></span>            </div>            <div class="color-item">              <span style="background: #E1C3DF"></span>              <span style="background: #844A97"></span>              <span style="background: #5A1A6F"></span>            </div>          </div>        </div>      </div>    </div>    <div class="tab">      <input type="radio" name="tabs" id="tab2">      <label for="tab2">外框</label>      <div class="tickets-tab-content">        <div class="color-ticket">          <div class="outer-frame">            <div class="color-item">              <span class="white" style="background: #FFFFFF;"></span>              <span style="background: #747D7E"></span>              <span style="background: #000000"></span>            </div>            <div class="color-item">              <span style="background: #F7C3C7"></span>              <span style="background: #E84341"></span>              <span style="background: #8A1712"></span>            </div>            <div class="color-item">              <span style="background: #FFEDC5"></span>              <span style="background: #F3942E"></span>              <span style="background: #8D4A15"></span>            </div>            <div class="color-item">              <span style="background: #FBF7C7"></span>              <span style="background: #F9EB30"></span>              <span style="background: #8D7F1C"></span>            </div>            <div class="color-item">              <span style="background: #D8EAD0"></span>              <span style="background: #7ABC62"></span>              <span style="background: #247B34"></span>            </div>            <div class="color-item">              <span style="background: #C8E6EE"></span>              <span style="background: #4CBFBF"></span>              <span style="background: #019BAD"></span>            </div>            <div class="color-item">              <span style="background: #C6E0F7"></span>              <span style="background: #4A87C6"></span>              <span style="background: #08468F"></span>            </div>            <div class="color-item">              <span style="background: #E1C3DF"></span>              <span style="background: #844A97"></span>              <span class="non-color" style="background: #B3B3B3"></span>            </div>          </div>        </div>      </div>    </div>  </div></div>';new Dialogify(a,{size:"dialogify__fixedwidth stickeredit",useDialogForm:!1,closable:!1}).title("編輯戰圖").buttons([{text:"取消",click:function(s){this.close()}},{text:"發送",type:Dialogify.BUTTON_PRIMARY,click:function(a){var l=[];t(".stickeredit_image .edit-text").each(function(s,e){var i=t(e).data("deg")||0,a={text:t(e).text().trim(),text_size:parseFloat(t(e).css("font-size"))/parseFloat(t(".stickeredit_image").height()),text_position_x:(parseFloat(t(e).css("left"))+8)/parseFloat(t(".stickeredit_image").width()),text_position_y:(parseFloat(t(e).css("top"))+8)/parseFloat(t(".stickeredit_image").height()),text_color:c(t(e).css("color")),text_angle:parseInt(i)};"0px"!=t(e).css("-webkit-text-stroke-width")?(a.text_has_stroke=!0,a.text_stroke_color=c(t(e).css("-webkit-text-stroke-color"))):a.text_has_stroke=!1,l.push(a)}),i.im.sendFightSticker(s,e,l),this.close()}}]).showModal();i.layout.updateSticker(),t("#addNick").click(function(){t("#stickerText").val(t("#stickerText").val()+i.im.nick),t(".stickeredit_image .is-active span").text(t("#stickerText").val())}),t("#addText").click(function(){t(".stickeredit_image .is-active").removeClass("is-active");var s=t("<div>"),e=t("<span>");e.text(t("#stickerText").val()),s.append(e),s.append('<div class="rotate-point bottom-r"><img src="https://im.bahamut.com.tw/hahamut%2Fim_zoom.svg?alt=media"></div><div class="rotate-point bottom-l"><img src="https://im.bahamut.com.tw/hahamut%2Fim_rotate.svg?alt=media"></div>'),s.addClass("edit-text"),s.addClass("is-active"),s.attr("style","top: 0; left: 0; font-size: 32px;color: #000000; -webkit-text-stroke: 1px #FFFFFF;"),s.click(o),t("#stickerDiv").append(s),s.jqDrag().jqResize(".bottom-r").jqRotate(".bottom-l")}),t("#addText").click(),t("#deleteText").click(function(){t("#stickerText").val(""),t("#stickerDiv .is-active").remove()}),t("#stickerText").keyup(function(){t(".stickeredit_image .is-active");t(".stickeredit_image .is-active span").text(t("#stickerText").val())}),t(".coloring .color-item span").each(function(s,e){t(e).click(function(){t(".coloring .color-item span").removeClass("is-active"),t(e).addClass("is-active"),l(t(e).css("background-color"))})}),t(".outer-frame .color-item span").each(function(s,e){t(e).click(function(){t(".outer-frame .color-item span").removeClass("is-active"),t(e).addClass("is-active"),r(t(e).hasClass("non-color")?"":t(e).css("background-color"))})})},"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define("im_layout_lib",[],function(){return a}):s.BAHA_IM_LAYOUT_LIB=a}(window,window.document,jQuery);