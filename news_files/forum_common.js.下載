!function(t,e){"use strict";var i,a={initPhotoSwipe:function(t){e(t).on("click",".photoswipe-image",function(a){a.preventDefault();var o=[],r=e(a.target).parents(t),s=r.find(".photoswipe-image, .photoswipe-image-shrink");s.each(function(t,i){o.push({src:e(i).attr("href"),w:0,h:0})});for(var l=0,c=a.target.src,d=0;d<o.length;d++)if(c==o[d].src){l=d;break}n.index=l,n.bhContainer=r,i=new PhotoSwipe(e(".pswp").get(0),PhotoSwipeUI_Default,o,n),i.listen("gettingData",function(t,e){if(void 0===e.onLoading&&(e.w<1||e.h<1)){e.onLoading=!0;var a=new Image;a.onload=function(){e.w=this.width,e.h=this.height,i.invalidateCurrItems(),i.updateSize(!0)},a.src=e.src}}),i.init()})},expandImage:function(t,i){t.preventDefault();var a=e(i).attr("href"),n=e(i).data("url"),o=e(i).data("style"),r=e("<a>").attr("href",n||a),s=e("<img>").attr("data-src",a).addClass("lazyload");n?r.attr({target:"_blank",onclick:"Forum.Common.refUrl(this);"}):r.addClass("photoswipe-image"),o&&s.attr("style",o),r.append(s),e(i).replaceWith(r)},expandVideo:function(t,i){t.preventDefault();var a,n=e(i).attr("href"),o=Util.EmbedPlayer.TO_WRAPPER_IFRAME;switch(e(i).data("type")){case"video-youtube":a=new Util.EmbedPlayer.Youtube(n,o).toString();break;case"video-niconico":a=new Util.EmbedPlayer.Niconico(n,o).toString();break;case"video-twitch":case"video-twitchvod":a=new Util.EmbedPlayer.Twitch(n,o).toString();break;case"video-xuite":a=new Util.EmbedPlayer.Xuite(n,o).toString();break;case"video-livehouse":a=new Util.EmbedPlayer.Livehouse(n,o).toString();break;case"video-facebook":a=new Util.EmbedPlayer.Facebook(n,o).toString()}a&&e(i).replaceWith(a)},expandAll:function(){e(".loadpic").click()},addDarkThemeSwitch:function(){var t='<dd>  <a href="javascript:;" class="BH-menu__dark">深色主題    <div class="BH-menu__switch-box">      <input id="themeSwitch" class="BH-menu__switch-box__switch-input" type="checkbox">      <label for="themeSwitch" class="BH-menu__switch-box__option">        <span class="BH-menu__switch-box__active-state">ON</span>        <div class="BH-menu__switch-box__icon"></div>        <span class="BH-menu__switch-box__inactive-state">OFF</span>      </label>    </div>  </a></dd>';e(".BH-menu-forumA-right.dropList dl").append(t),"yes"==Cookies.get("ckForumDarkTheme")&&(e(".BH-menu__switch-box").addClass("is-on"),e("#themeSwitch").prop("checked",!0)),e(".BH-menu__dark").click(function(t){e(".BH-menu__switch-box").toggleClass("is-on");var i=e(".BH-menu__switch-box").hasClass("is-on");e("#themeSwitch").prop("checked",i),i?(e("<link>").attr({rel:"stylesheet",type:"text/css",href:"https://i2.bahamut.com.tw/css/forum_dark.css?_=8"}).insertAfter("link:last"),Cookies.set("ckForumDarkTheme","yes",{expires:365,domain:"gamer.com.tw"}),ga("send","event","其它點擊","哈啦區","套用深色主題")):(e('link[href*="forum_dark.css"]').remove(),Cookies.remove("ckForumDarkTheme",{domain:"gamer.com.tw"}),ga("send","event","其它點擊","哈啦區","取消深色主題"))})},refUrl:function(t){t.href.match(/^https?:\/\/ref\.gamer\.com\.tw/)||(t.href="https://ref.gamer.com.tw/redir.php?url="+encodeURIComponent(t.href))},utf8Length:function(t){var e=t.match(/[^\x00-\xff]/gi);return null===e?t.length:t.length+2*e.length}},n={captionEl:!1,bgOpacity:.85,showHideOpacity:!0,history:!1,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">圖片</a>無法載入</div>',shareButtons:[{id:"download",label:"儲存圖片",url:"{{raw_image_url}}",download:!0}]};t.Forum=t.Forum||{},t.Forum.Common=a}(window,jQuery),function(t,e){"use strict";function i(t){var i=[],a=0,o=new Dropzone(".dropzone",{url:"/ajax/insertimage_truth_upload.php",paramName:"dzfile",acceptedFiles:"image/gif,image/jpeg,image/png",resizeWidth:1920,resizeQuality:1,dictInvalidFileType:"上傳圖檔格式需為GIF, JPG, PNG",transformFile:function(t,e){return(this.options.resizeWidth||this.options.resizeHeight)&&"image/gif"!=t.type?this.resizeImage(t,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,e):e(t)}});o.on("addedfile",function(t){a++}),o.on("success",function(t,e){void 0!==e.code&&e.message?o.emit("error",t,e.message):(a--,Array.prototype.push.apply(i,e))}),o.on("queuecomplete",function(){0!=i.length&&(0==a?n(t,i):(e(".dialogify .tab-menu__3 .tab-menu__item1").data("buttonEnabled",!0),t.dialog.$buttonList[2].data("images",i).enable()))})}function a(t){var i=e("#insertImageTruthList"),a=e("#insertImageMoreBtn");t=t||i.data("page");e.get("/ajax/insertimage_truth_list.php",{p:t},function(n){if("ERR_NOLOGIN"==n)return void Dialogify.alert("請先登入");if("ERR_EMPTY"==n)return void a.hide();var o=e("<div>").append(n);o.find(".uploadimage-home__item").length<12?a.hide():a.show(),1==t&&i.children(":not(#insertImageMoreBtn)").remove(),a.before(n),i.data("page",++t)})}function n(t,e){"string"==typeof e&&(e=e.replace(/\n$/,""),e=e.split(/\n/));for(var i="",a=0;a<e.length;a++)""!==e[a]&&(i+=t.options.contentCallback?t.options.contentCallback.call(t,e[a]):t.plainText?e[a]:'<img src="'+e[a]+'">',a<e.length-1&&(i+=t.plainText?"\n":"<br>"));""!==i&&(t.plainText?s(t,i):l(t,i)),t.options.onInsert&&t.options.onInsert.call(t)}function o(t){var i=[],a="";e('[name="insertImageCheck"]:checked').each(function(t,a){i.push([e(a).data("sort"),e(a).val()])}),i.sort(r);for(var o in i)a+=i[o][1]+"\n";return""===a?void Dialogify.alert("請勾選要引用的圖片"):void n(t,a)}function r(t,e){return t[0]===e[0]?0:t[0]<e[0]?-1:1}function s(t,e){if(t.plainText){t.dialog.close(),m(t);var i=t.$editor,a=i.prop("selectionStart"),n=i.val().substring(0,a),o=i.val().substring(i.prop("selectionEnd"));i.val(n+e+o),i.prop("selectionStart",a),i.prop("selectionEnd",a+e.length)}}function l(e,i){if(!e.plainText)if(e.dialog.close(),m(e),t.navigator.userAgent.match(/trident\/.*rv:([0-9]{1,}[.0-9]{0,})/i)){var a,n;if(a=e.win.getSelection(),a&&a.getRangeAt&&a.rangeCount){n=a.getRangeAt(0),n.deleteContents();var o=n.createContextualFragment(i);n.insertNode(o),n.collapse(!1)}}else e.win.document.execCommand("inserthtml",!1,i)}function c(){e(".dialogify .input-box .clearall").click(function(t){e(this).removeClass("is-active").next("input").val("")}),e(".dialogify .input-box input").on("input",function(t){e(this).val()?e(this).prev(".clearall").addClass("is-active"):e(this).prev(".clearall").removeClass("is-active")})}function d(t){if(t.plainText)return{isImage:!1};var i=t.win.getSelection();if(!i||0==i.rangeCount)return{isImage:!1};var a=i.getRangeAt(0);if(!a)return{isImage:!1};var n=a.startContainer;if(!n.tagName)return{isImage:!1};var o=n.childNodes[a.startOffset];if(!o||!o.nodeName.toLowerCase().equals("img"))return{isImage:!1};var r=e(o).width()||0,s=e(o).height()||0,l=o.getAttribute("src")||"",c=!!l.match(/^https?:\/\/i2\.bahamut\.com\.tw\/editor\/emotion\//),d=o.getAttribute("data-movie")||"";return!d&&l.match(/movie_pre.gif$/)&&(d=o.getAttribute("alt")||""),{isImage:!0,url:l,width:r,height:s,video:d,emotion:c}}function h(t){if(t.plainText){var e=t.$editor.prop("selectionStart"),i=t.$editor.prop("selectionEnd");return t.$editor.val().substring(e,i)}var a=t.win.getSelection();if(!a||0==a.rangeCount)return"";var n=a.getRangeAt(0);return n?n.toString():""}function p(t){t.plainText?t.$editor.focus():(t.win.focus(),t.$editor.get(0).focus())}function u(t){if(p(t),t.plainText)v={selectionStart:t.$editor.prop("selectionStart"),selectionEnd:t.$editor.prop("selectionEnd")};else{var e=t.win.getSelection();e&&0!=e.rangeCount||(v=null);var i=e.getRangeAt(0);i||(v=null),v={range:i}}}function m(t){if(v)if(p(t),t.plainText)v.selectionStart&&v.selectionEnd&&t.$editor.prop("selectionStart",v.selectionStart).prop("selectionEnd",v.selectionEnd);else if(v.range){var e=t.win.getSelection();e&&(e.removeAllRanges(),e.addRange(v.range))}}function g(t){e('[name="insertImageCheck"]:checked').each(function(i,a){var n=e(a).attr("id"),o=e("label[for="+n+"] > div").text();o>t&&e("label[for="+n+"] > div").text(--o)})}var f=function(t,e){this.editor(t),this.options=e||{}};f.prototype.editor=function(i){if(this.$editor=e(i),this.$editor.get(0).contentWindow)this.plainText=!1,this.win=this.$editor.get(0).contentWindow;else if(this.$editor.attr("contenteditable"))this.plainText=!1,this.win=t;else{if(!(this.$editor.prop("tagName").match(/^textarea$/i)||this.$editor.prop("tagName").match(/^input$/i)&&this.$editor.attr("type").match(/^text$/i)))throw"unsupported element";this.plainText=!0,this.win=null}},f.prototype.showDialog=function(){var t={useDialogForm:!1,size:Dialogify.SIZE_LARGE,closable:!1},r=this;this.dialog=new Dialogify("#insertImageTemplate",t),e(".dialogify .tab-menu__3").children("li").click(function(t){var i=e(this).index();e(".dialogify .tab-wrapper").children("div").hide().filter(":eq("+i+")").show(),e(this).addClass("active").siblings("li").removeClass("active");var n=r.dialog.$buttonList[2];switch(i){case 1:a(1);break;case 2:e("#insertImageUrl").focus()}e(this).data("buttonEnabled")?n.enable():n.disable()}),e("#insertImageUrl").on("input",function(t){var i,a=e(".dialogify .tab-menu__3 .tab-menu__item3"),n=r.dialog.$buttonList[2],o=e(".uploadimage-url .imgbox p"),s=e(".uploadimage-url .imgbox"),l=/(^https:\/\/(?:.*?)\.(?:jpg|jpeg|gif|png))(?:\?[^\?]*)?$/i;(i=e(this).val().match(l))?(a.data("buttonEnabled",!0),n.enable(),o.hide(),s.find("img").length?s.find("img").attr("src",i[1]):s.append('<img src="'+i[1]+'">')):(s.find("img").remove(),a.removeData("buttonEnabled"),n.disable(),o.text("錯誤的圖片格式").addClass("is-error").show())}),e("#insertImageTruthList").on("click",".imgbox",function(t){var i=e(this).prev(".check-group").find("input").val();n(r,i)});var s=0;e("#insertImageTruthList").on("change",'[name="insertImageCheck"]',function(t){var i=r.dialog.$buttonList[2];e('[name="insertImageCheck"]:checked').length?i.enable():i.disable();var a=(new Date).getTime(),n=e("label[for="+e(this).attr("id")+"] > div");if(e(this).is(":checked")===!0)e(this).attr("data-sort",a),s++,n.text(s);else{e(this).removeAttr("data-sort");var o=n.text();g(o),s--}}),e("#insertImageMoreBtn a").click(function(t){a()}),c(),u(this);var l="",p=d(this);if(p.isImage&&""===p.video&&!p.emotion)l=decodeURI(p.url);else{var f=h(this);f.match(/^https?:\/\/(?:.*?)\.(?:jpg|jpeg|gif|png)(?:\?[^\?]*)?$/i)&&(l=f)}this.dialog.title("插入圖片").buttons(['<a class="post__text-small float-left" href="https://home.gamer.com.tw/truthList.php" target="_blank">管理小屋圖片</a>',{text:"取消",click:function(){this.close(),m(r)}},{text:"插入圖片",type:Dialogify.BUTTON_PRIMARY,click:function(){var t=e(".dialogify .tab-menu__3 li.active").index();switch(t){case 0:n(r,this.$buttonList[2].data("images"));break;case 1:o(r);break;case 2:n(r,e("#insertImageUrl").val())}},disabled:!0}]).on("show",function(){i(r),e.get("/ajax/insertimage_truth_quota.php",function(t){var e=0==t.total?0:new Number(t.used/t.total*100).toFixed(2);r.dialog.$content.find("#truthTotal").text(t.total/1024).end().find("#truthUsed").text(e).end().find("#truthSize").text(t.size)})}).showModal(),""!==l&&(e(".dialogify .tab-menu__3 li:eq(2)").click(),e("#insertImageUrl").val(l).trigger("input"))},f.prototype.contentCallback=function(t){this.options.contentCallback=t};var v,b='<div class="tab-wrapper"><ul class="tab-menu text-center tab-menu__3"><li class="tab-menu__item1 active"><a href="javascript:;">上傳</a></li><li class="tab-menu__item2"><a href="javascript:;">小屋圖片</a></li><li class="tab-menu__item3"><a href="javascript:;">網址</a></li><hr></ul><div class="upload-files"><div class="tab-content dialog__maxheight tab-box uploadimage dropzone"><div class="upload-files__body dz-message"><img src="https://i2.bahamut.com.tw/forum/icons/pixel-preview.svg" class="pointer-none uploadimage_img"><div class="pointer-none"><h3>將圖片拖曳到這裡</h3><a href="javascript:;" class="btn">或選擇上傳圖片</a><p>單張上限 <b id="truthSize"></b>K，超過上限圖片將會自動壓縮</p></div></div></div><p class="post__text-small text-center">你已使用小屋圖片空間 <span id="truthTotal"></span>MB 中的 <span id="truthUsed"></span>%</p></div><div class="tab-content dialog__maxheight tab-box uploadimage-home" style="display:none;"><div id="insertImageTruthList" class="uploadimage-home__list uploadimage-home__list__maxheight"><div id="insertImageMoreBtn" class="uploadimage-home__btnbg"><a href="javascript:;" class="uploadimage-home__btn">顯示更多...</a></div></div></div><div class="tab-content dialog__maxheight tab-box uploadimage-url" style="display:none;"><div class="input-box"><a href="javascript:;" class="clearall"></a><input type="text" class="form-control" id="insertImageUrl" placeholder="輸入圖片網址"></div><h5 class="post__text-small">因應網頁瀏覽安全，站上只支援 https 圖片連結。</h5><div class="imgbox"><p class="post__text-small">此處將顯示圖片預覽</p></div></div></div>';e("<script>").attr({type:"text/template",id:"insertImageTemplate"}).html(b).insertAfter(e("script:last")),t.Bahamut=t.Bahamut||{},t.Bahamut.InsertImage=f}(window,jQuery);