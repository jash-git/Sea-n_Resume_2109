!function(e,s){function t(){var t=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},a=function(e){return Object.keys(e).map(function(s){return e[s]}).join(" ")},i=function(e,s){return Cookies.set("ckFORUM_stype","title"),Cookies.set("ckFORUM_sval",s),"B.php?bsn="+e+"&qt=1&q="+encodeURIComponent(s)};const r="ckFORUM_searchType";this.initializeUI=function(){if(this.bsn=Number(t("bsn")),this.searchTerm={},this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",this.searchBoxRender(),this.resetGoogleStyle(),this.saveRecentSearch(),this.keywordsRender(),google.search.cse.element.getElement("forumSearch").prefillQuery(t("q")),Cookies.get("ckFORUM_stype")&&Cookies.get("ckFORUM_sval")||useOldSearch||"baha"==Cookies.get(r)){e("#searchbox").hide(),e("#searchbox_mobile").hide(),e("#old_search_searchbox").show(),e("#old_search_searchbox_mobile").show();var s;switch(Cookies.get("ckFORUM_stype")){case"M":s="找M文";break;case"author":s="找作者";break;default:s="找標題"}e("#old_search_input").attr("placeholder",s),e("#old_search_input_mobile").attr("placeholder",s)}},this.searchBoxRender=function(){google.search.cse.element.render({div:"searchbox",attributes:{autoCompleteMaxCompletions:5,autoCompleteMatchType:"any",resultsUrl:"https://forum.gamer.com.tw/search.php?bsn="+this.bsn,queryParameterName:"q",gaCategoryParameter:this.bsn,gaQueryParameter:"q",enableHistory:!0},tag:"searchbox-only",gname:"forumSearch"})},this.searchResultsRender=function(e){google.search.cse.element.render({div:"searchresults",attributes:{webSearchQueryAddition:a(this.searchTerm),linkTarget:"_blank",queryParameterName:"q",gaCategoryParameter:this.bsn,gaQueryParameter:"q",filters:1,enableOrderBy:e},tag:"searchresults-only",gname:"forumSearch"})},this.searchResultsReload=function(s,t){e("#searchresults").empty(),this.searchResultsRender(s),t&&google.search.cse.element.getElement("forumSearch").execute(t)},this.resetGoogleStyle=function(){var s=e('link[href$="default.css"],link[href$="default+zh_TW.css"]');s.filter('[href*="www.google.com"]').remove();var t=e(".gcse-bar"),a=e("#gsc-i-id1"),i=e(".gcse-option-control"),o=e(".gcse-tab-child");t.on("mouseenter",function(){e(".gcse-option, .gsc-input-box").addClass("is-hover")}).on("mouseleave",function(){e(".gcse-dropdown").hasClass("is-active")||(e(".gcse-option, .gsc-input-box").removeClass("is-hover"),i.removeClass("is-active"))}),e("#old_search_input").on("focus",function(){e(".gcse-suggest").addClass("is-active")}).on("blur",function(){0==e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active"),e(".gsc-input-box").removeClass("is-focus is-hover")}),e("#old_search_input_mobile").on("focus",function(){e(".gcse-suggest").addClass("is-active")}).on("blur",function(){0==e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active"),e(".gsc-input-box").removeClass("is-focus is-hover")}),a.on("focus",function(){e(".gcse-suggest").addClass("is-active")}).on("blur",function(){0===e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active"),e(".gsc-input-box").removeClass("is-focus is-hover")}).on("mouseenter",function(){e(this).is(":focus")&&!e(".gcse-suggest").hasClass("is-active")&&e(".gcse-suggest").addClass("is-active")}).attr("placeholder","輸入 1 或多字元來找文章…"),e("input.gsc-input").on("focus",function(){e(".gsc-input-box, .gcse-option").addClass("is-focus")}).on("blur",function(){e(".gsc-input-box").removeClass("is-focus")}),i.on("click",function(){e(this).hasClass("is-active")?e(this).blur():(e(".gcse-sort").addClass("is-active"),e(this).addClass("is-active").focus(),e(".gcse-suggest").removeClass("is-active"))}).on("blur",function(){i.removeClass("is-active"),0===e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active")}),e(".gcse-sort > ul > li").on("click",function(){e(".gcse-sort").removeClass("is-active");var s=e(".gcse-dropdown > ul > li").index(e(this));if(s>4&&(s-=4),3==s)Cookies.set(r,"google",{expires:365}),e("#old_search_searchbox").hide(),e("#old_search_searchbox_mobile").hide(),e("#gsc-i-id1").val(e("#old_search_input").val()),e("#searchbox").show(),e("#searchbox_mobile").show(),e("#gsc-i-id1").focus();else switch(Cookies.set(r,"baha",{expires:365}),e("#searchbox").hide(),e("#old_search_input").val(e("#gsc-i-id1").val()),e("#old_search_searchbox").show(),e("#old_search_input").attr("placeholder",e(this).find(".gcse-sort-title").text()).focus(),e("#searchbox_mobile").hide(),e("#old_search_input_mobile").val(e("#gsc-i-id1").val()),e("#old_search_searchbox_mobile").show(),e("#old_search_input_mobile").attr("placeholder",e(this).find(".gcse-sort-title").text()).focus(),s){case 1:e("#stype").val(2),e("#stype_mobile").val(2);break;case 2:e("#stype").val(4),e("#stype_mobile").val(4);break;default:e("#stype").val(1),e("#stype_mobile").val(1)}});var c=e(".gcse-clear"),n=this;c.click(function(){location.href="listtype.php?bsn="+n.bsn+"&stype=10"}),Cookies.get("ckFORUM_stype")&&Cookies.get("ckFORUM_sval")?c.show():c.hide(),e("#gsc-i-id1").keyup(function(s){e(this).val().length>0?e(".gcse-option-control, .gcse-suggest").removeClass("is-active"):e(".gcse-suggest").addClass("is-active")}),e("#old_search_form").submit(function(){return e("#old_search_input").val().length<1?(Dialogify.alert("請輸入搜尋內容"),!1):void(ga&&ga("send",{hitType:"event",eventCategory:"互動",eventAction:"哈啦區",eventLabel:"桌面搜尋",useBeacon:!0}))}),e("#old_search_form_mobile").submit(function(){return e("#old_search_input_mobile").val().length<1?(Dialogify.alert("請輸入搜尋內容"),!1):void(ga&&ga("send",{hitType:"event",eventCategory:"互動",eventAction:"哈啦區",eventLabel:"桌面搜尋",useBeacon:!0}))});var h=this;o.on("click",function(){o.removeClass("is-active"),e(this).addClass("is-active"),h.changeArea(e(this).attr("id"))})},this.saveRecentSearch=function(){var e=t("q");if(e&&"undefined"!=typeof Storage){var s=JSON.parse(localStorage.getItem("forumSearch"));s=s?s:{},s[this.bsn]=s[this.bsn]?s[this.bsn]:[],s[this.bsn].unshift(e),s[this.bsn]=s[this.bsn].filter(function(e,s,t){return t.indexOf(e)==s}),s[this.bsn]=s[this.bsn].slice(0,15),localStorage.setItem("forumSearch",JSON.stringify(s))}},this.keywordsRender=function(){function t(s,t,a,i,r){if(t.length){var o=e("<div>").addClass(a);for(var c in t)o.append('<a data-bsn="'+r+'" data-search-dynamic>'+t[c]+"</a>");i.append("<h3>"+s+"</h3>").append(o)}}var a=[];if("undefined"!=typeof Storage){var r=JSON.parse(localStorage.getItem("forumSearch"));null!=r&&null!=r[this.bsn]&&Array.isArray(r[this.bsn])&&(a=r[this.bsn].map(function(e){var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return s[e]})}))}hotKeywords.length||a.length?(t("最近搜尋",a,"search-suggest-tag",e(".right-child"),this.bsn),t("最近搜尋",a,"gcse-suggest-tag",e("#gcse-suggest-child-recently_mobile"),this.bsn),t("最近搜尋",a,"gcse-suggest-tag",e("#gcse-suggest-child-recently"),this.bsn),t("熱門搜尋",hotKeywords,"search-suggest-tag",e(".right-child"),this.bsn),t("熱門搜尋",hotKeywords,"gcse-suggest-tag",e("#gcse-suggest-child-hot"),this.bsn),t("熱門搜尋",hotKeywords,"gcse-suggest-tag",e("#gcse-suggest-child-hot_mobile"),this.bsn),e("a[data-search-dynamic]").bind("click",function(){var t;t=e(this).parent().hasClass("gcse-suggest-tag")?e("#searchbox").is(":visible")?"search.php?bsn="+e(this).data("bsn")+"&q="+e(this).text():i(e(this).data("bsn"),e(this).text()):"/search.php"==s.location.pathname?"search.php?bsn="+e(this).data("bsn")+"&q="+e(this).text():i(e(this).data("bsn"),e(this).text()),e(this).attr("href",t)})):e(".search-suggest, .gcse-suggest").hide()},this.changeCondition=function(){this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",this.searchTerm.subbsn=e("#filter-subbsn").val()?"more:pagemap:thread-subbsn:"+e("#filter-subbsn").val():"",this.searchTerm.type="",e("#filter-article").is(":checked")&&(this.searchTerm.type="more:pagemap:thread-extract:T"),e("#filter-author").is(":checked")&&(this.searchTerm.type="more:pagemap:thread-author:"+e("#gsc-i-id1").val(),this.searchTerm.filename="more:pagemap:thread-filename:Co"),this.searchResultsReload(!0)},this.changeArea=function(s){var a=t("q");switch(this.searchTerm={},s){case"area_board":e(".gcse-forum").hide(),this.searchTerm.filename="more:pagemap:thread-filename:A",a&&this.searchResultsReload(!1,a);break;case"area_others":e(".gcse-forum").hide(),a&&this.searchResultsReload(!1,a+" "+e(".BH-menuE li:nth-child(2)").text()+" -site:forum.gamer.com.tw");break;case"area_extract":e(".gcse-forum").hide(),this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:G2",a&&this.searchResultsReload(!0,a);break;default:e(".gcse-forum").show(),this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",a&&this.searchResultsReload(!0,a)}},this.submit=function(){switch(e("#stype").val()){case"2":case"4":return!0;default:switch(Cookies.get("ckFORUM_stype")){case"M":case"author":return!0;default:var t=e("#old_search_input").val();return jQuery("#old_search_input_mobile").is(":visible")&&(t=e("#old_search_input_mobile").val()),s.location.href=i(this.bsn,t),!1}}}}s.forumSearch=new t}(jQuery,window),window.__gcse={parsetags:"explicit",callback:function(){"complete"==document.readyState?forumSearch.initializeUI():google.setOnLoadCallback(function(){forumSearch.initializeUI()},!0)}};